{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "QfZkNLUb4B-p"
      },
      "source": [
        "# ATT Estimation Tutorial\n",
        "\n",
        "This tutorial gives a short example for how to estimate average treatment effect on the treated using machine learning methods"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 1,
      "metadata": {
        "id": "dS2X3Bq1-fxE"
      },
      "outputs": [],
      "source": [
        "import numpy as np\n",
        "import pandas as pd\n",
        "import scipy as sp\n",
        "from sklearn.ensemble import RandomForestClassifier, RandomForestRegressor\n",
        "from sklearn.linear_model import LogisticRegression\n",
        "from sklearn.linear_model import LinearRegression\n",
        "from sklearn.model_selection import KFold, StratifiedKFold, train_test_split\n",
        "from sklearn.metrics import mean_squared_error, log_loss\n",
        "from xgboost import XGBClassifier, XGBRegressor\n",
        "import sklearn\n",
        "import os\n",
        "import matplotlib.pyplot as plt\n",
        "from matplotlib.pyplot import hist\n",
        "from tabulate import tabulate"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 2,
      "metadata": {
        "id": "nxJ46X9cFJ9X"
      },
      "outputs": [],
      "source": [
        "RANDOM_SEED=42\n",
        "np.random.seed(RANDOM_SEED)"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "CjKmYJkW2YiC"
      },
      "source": [
        "# Import dataset"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 4,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 505
        },
        "id": "-L-Q9K1V2XWI",
        "outputId": "cb93ea88-1102-40b5-c7fe-dfc50ad9c57d"
      },
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "      Unnamed: 0  ...1  followup_fallstudyhours  followup_getwritinghelp  \\\n",
              "0              1   186                       20                        2   \n",
              "1              2   830                       12                        2   \n",
              "2              3   837                       21                        3   \n",
              "3              4   952                       57                        2   \n",
              "4              5   261                       20                        1   \n",
              "...          ...   ...                      ...                      ...   \n",
              "1048        1049   737                       15                        5   \n",
              "1049        1050   807                        4                        5   \n",
              "1050        1051   503                       12                        5   \n",
              "1051        1052   900                       30                        5   \n",
              "1052        1053   427                        4                        4   \n",
              "\n",
              "      followup_metwithinstructor  followup_metwithfreetutor  \\\n",
              "0                              2                          0   \n",
              "1                              0                          2   \n",
              "2                              0                          0   \n",
              "3                              0                          0   \n",
              "4                              0                          0   \n",
              "...                          ...                        ...   \n",
              "1048                           1                          2   \n",
              "1049                           0                          0   \n",
              "1050                           1                          0   \n",
              "1051                           5                          2   \n",
              "1052                           0                          2   \n",
              "\n",
              "      followup_imptodowellatuoft  followup_depressed  followup_stressed  \\\n",
              "0                              7                   2                  1   \n",
              "1                              4                   2                  1   \n",
              "2                              6                   3                  3   \n",
              "3                              7                   3                  2   \n",
              "4                              7                   2                  3   \n",
              "...                          ...                 ...                ...   \n",
              "1048                           7                   3                  3   \n",
              "1049                           7                   3                  3   \n",
              "1050                           4                   1                  1   \n",
              "1051                           7                   1                  2   \n",
              "1052                           7                   3                  3   \n",
              "\n",
              "      fathers_education  mothers_education  fall_meangrade_year1  \\\n",
              "0                     1                  1             77.000000   \n",
              "1                     0                  0             73.666664   \n",
              "2                     1                  5             70.000000   \n",
              "3                     1                  1             81.000000   \n",
              "4                     6                  6             81.500000   \n",
              "...                 ...                ...                   ...   \n",
              "1048                  6                  2             81.333336   \n",
              "1049                  6                  6             73.500000   \n",
              "1050                  7                  7             73.000000   \n",
              "1051                  6                  6             79.666664   \n",
              "1052                  6                  6             66.500000   \n",
              "\n",
              "      exp_gradschl  agreeableness2  agreeableness  extraversion2  \\\n",
              "0                1       -0.517853              0      -2.751067   \n",
              "1                0        1.216498              1      -2.751067   \n",
              "2                0        0.831087              1      -2.751067   \n",
              "3                1        1.409204              1      -2.751067   \n",
              "4                1        1.794615              1      -2.591280   \n",
              "...            ...             ...            ...            ...   \n",
              "1048             1        0.252970              1       2.202324   \n",
              "1049             0       -1.095970              0       2.202324   \n",
              "1050             1       -1.866793              0       2.362111   \n",
              "1051             0       -0.710559              0       2.362111   \n",
              "1052             0       -1.095970              0       2.841471   \n",
              "\n",
              "      extraversion  study_habit  \n",
              "0                0            4  \n",
              "1                0            4  \n",
              "2                0            3  \n",
              "3                0            2  \n",
              "4                0            1  \n",
              "...            ...          ...  \n",
              "1048             1            8  \n",
              "1049             1            5  \n",
              "1050             1            6  \n",
              "1051             1           12  \n",
              "1052             1            6  \n",
              "\n",
              "[1053 rows x 18 columns]"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-23655cb0-da9d-4c7f-a5a1-805092cd8ab7\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>Unnamed: 0</th>\n",
              "      <th>...1</th>\n",
              "      <th>followup_fallstudyhours</th>\n",
              "      <th>followup_getwritinghelp</th>\n",
              "      <th>followup_metwithinstructor</th>\n",
              "      <th>followup_metwithfreetutor</th>\n",
              "      <th>followup_imptodowellatuoft</th>\n",
              "      <th>followup_depressed</th>\n",
              "      <th>followup_stressed</th>\n",
              "      <th>fathers_education</th>\n",
              "      <th>mothers_education</th>\n",
              "      <th>fall_meangrade_year1</th>\n",
              "      <th>exp_gradschl</th>\n",
              "      <th>agreeableness2</th>\n",
              "      <th>agreeableness</th>\n",
              "      <th>extraversion2</th>\n",
              "      <th>extraversion</th>\n",
              "      <th>study_habit</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>1</td>\n",
              "      <td>186</td>\n",
              "      <td>20</td>\n",
              "      <td>2</td>\n",
              "      <td>2</td>\n",
              "      <td>0</td>\n",
              "      <td>7</td>\n",
              "      <td>2</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>77.000000</td>\n",
              "      <td>1</td>\n",
              "      <td>-0.517853</td>\n",
              "      <td>0</td>\n",
              "      <td>-2.751067</td>\n",
              "      <td>0</td>\n",
              "      <td>4</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>2</td>\n",
              "      <td>830</td>\n",
              "      <td>12</td>\n",
              "      <td>2</td>\n",
              "      <td>0</td>\n",
              "      <td>2</td>\n",
              "      <td>4</td>\n",
              "      <td>2</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "      <td>0</td>\n",
              "      <td>1.216498</td>\n",
              "      <td>1</td>\n",
              "      <td>-2.751067</td>\n",
              "      <td>0</td>\n",
              "      <td>4</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>3</td>\n",
              "      <td>837</td>\n",
              "      <td>21</td>\n",
              "      <td>3</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>6</td>\n",
              "      <td>3</td>\n",
              "      <td>3</td>\n",
              "      <td>1</td>\n",
              "      <td>5</td>\n",
              "      <td>70.000000</td>\n",
              "      <td>0</td>\n",
              "      <td>0.831087</td>\n",
              "      <td>1</td>\n",
              "      <td>-2.751067</td>\n",
              "      <td>0</td>\n",
              "      <td>3</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>4</td>\n",
              "      <td>952</td>\n",
              "      <td>57</td>\n",
              "      <td>2</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>7</td>\n",
              "      <td>3</td>\n",
              "      <td>2</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>81.000000</td>\n",
              "      <td>1</td>\n",
              "      <td>1.409204</td>\n",
              "      <td>1</td>\n",
              "      <td>-2.751067</td>\n",
              "      <td>0</td>\n",
              "      <td>2</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>5</td>\n",
              "      <td>261</td>\n",
              "      <td>20</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>7</td>\n",
              "      <td>2</td>\n",
              "      <td>3</td>\n",
              "      <td>6</td>\n",
              "      <td>6</td>\n",
              "      <td>81.500000</td>\n",
              "      <td>1</td>\n",
              "      <td>1.794615</td>\n",
              "      <td>1</td>\n",
              "      <td>-2.591280</td>\n",
              "      <td>0</td>\n",
              "      <td>1</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>...</th>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "      <td>...</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1048</th>\n",
              "      <td>1049</td>\n",
              "      <td>737</td>\n",
              "      <td>15</td>\n",
              "      <td>5</td>\n",
              "      <td>1</td>\n",
              "      <td>2</td>\n",
              "      <td>7</td>\n",
              "      <td>3</td>\n",
              "      <td>3</td>\n",
              "      <td>6</td>\n",
              "      <td>2</td>\n",
              "      <td>81.333336</td>\n",
              "      <td>1</td>\n",
              "      <td>0.252970</td>\n",
              "      <td>1</td>\n",
              "      <td>2.202324</td>\n",
              "      <td>1</td>\n",
              "      <td>8</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1049</th>\n",
              "      <td>1050</td>\n",
              "      <td>807</td>\n",
              "      <td>4</td>\n",
              "      <td>5</td>\n",
              "      <td>0</td>\n",
              "      <td>0</td>\n",
              "      <td>7</td>\n",
              "      <td>3</td>\n",
              "      <td>3</td>\n",
              "      <td>6</td>\n",
              "      <td>6</td>\n",
              "      <td>73.500000</td>\n",
              "      <td>0</td>\n",
              "      <td>-1.095970</td>\n",
              "      <td>0</td>\n",
              "      <td>2.202324</td>\n",
              "      <td>1</td>\n",
              "      <td>5</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1050</th>\n",
              "      <td>1051</td>\n",
              "      <td>503</td>\n",
              "      <td>12</td>\n",
              "      <td>5</td>\n",
              "      <td>1</td>\n",
              "      <td>0</td>\n",
              "      <td>4</td>\n",
              "      <td>1</td>\n",
              "      <td>1</td>\n",
              "      <td>7</td>\n",
              "      <td>7</td>\n",
              "      <td>73.000000</td>\n",
              "      <td>1</td>\n",
              "      <td>-1.866793</td>\n",
              "      <td>0</td>\n",
              "      <td>2.362111</td>\n",
              "      <td>1</td>\n",
              "      <td>6</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1051</th>\n",
              "      <td>1052</td>\n",
              "      <td>900</td>\n",
              "      <td>30</td>\n",
              "      <td>5</td>\n",
              "      <td>5</td>\n",
              "      <td>2</td>\n",
              "      <td>7</td>\n",
              "      <td>1</td>\n",
              "      <td>2</td>\n",
              "      <td>6</td>\n",
              "      <td>6</td>\n",
              "      <td>79.666664</td>\n",
              "      <td>0</td>\n",
              "      <td>-0.710559</td>\n",
              "      <td>0</td>\n",
              "      <td>2.362111</td>\n",
              "      <td>1</td>\n",
              "      <td>12</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1052</th>\n",
              "      <td>1053</td>\n",
              "      <td>427</td>\n",
              "      <td>4</td>\n",
              "      <td>4</td>\n",
              "      <td>0</td>\n",
              "      <td>2</td>\n",
              "      <td>7</td>\n",
              "      <td>3</td>\n",
              "      <td>3</td>\n",
              "      <td>6</td>\n",
              "      <td>6</td>\n",
              "      <td>66.500000</td>\n",
              "      <td>0</td>\n",
              "      <td>-1.095970</td>\n",
              "      <td>0</td>\n",
              "      <td>2.841471</td>\n",
              "      <td>1</td>\n",
              "      <td>6</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "<p>1053 rows × 18 columns</p>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-23655cb0-da9d-4c7f-a5a1-805092cd8ab7')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-23655cb0-da9d-4c7f-a5a1-805092cd8ab7 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-23655cb0-da9d-4c7f-a5a1-805092cd8ab7');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 4
        }
      ],
      "source": [
        "data = pd.read_csv(\"https://raw.githubusercontent.com/BaichenTan/ExperimentData_Adv/master/dataset_trimmed_extraversion_final.csv\")\n",
        "data\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "Q57avql1Pu4k"
      },
      "source": [
        "## Counfounders, Outcome, and Treatment"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 5,
      "metadata": {
        "id": "PHF8AKpy4o4I"
      },
      "outputs": [],
      "source": [
        "#create a dataset of confounders\n",
        "confounders_without_Mediator = data[['fathers_education', 'mothers_education']]\n",
        "confounders_with_allMediators = data[[\"followup_fallstudyhours\", \"followup_imptodowellatuoft\", \"followup_depressed\", \"followup_stressed\", \"fathers_education\",\t\"mothers_education\", \"exp_gradschl\", \"study_habit\"]]\n",
        "confounders_with_mediatorStudyHours = data[[\"followup_fallstudyhours\", \"followup_imptodowellatuoft\", \"followup_depressed\", \"followup_stressed\", \"fathers_education\",\t\"mothers_education\", \"exp_gradschl\"]]\n",
        "confounders_with_mediatorStudyHabits = data[[\"study_habit\",\"followup_imptodowellatuoft\", \"followup_depressed\", \"followup_stressed\", \"fathers_education\",\t\"mothers_education\", \"exp_gradschl\"]]\n",
        "outcome = data['fall_meangrade_year1']\n",
        "treatment = data['extraversion']\n",
        "placebo = data['agreeableness']"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "C576dWRsa3ad"
      },
      "source": [
        "## Specify Nuisance Function Models\n",
        "\n",
        "The next step is to specify models for the conditional expected outcome and propensity score"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "5PmmVpO89glE"
      },
      "source": [
        "## Q model with randomforest"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 6,
      "metadata": {
        "id": "qyOhSZRQRb8W"
      },
      "outputs": [],
      "source": [
        "# specify a model for the conditional expected outcome\n",
        "\n",
        "# make a function that returns a sklearn model for later use in k-folding\n",
        "def make_Qmodel_randomForest():\n",
        "  return RandomForestRegressor(random_state=RANDOM_SEED, n_estimators=500, max_depth=3)\n",
        "\n",
        "Qmodel_randomForest = make_Qmodel_randomForest()\n",
        "\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation "
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "gbhY1xyi9WfR"
      },
      "source": [
        "## Q model with linear regression"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 7,
      "metadata": {
        "id": "KlvJEIUb9W1D"
      },
      "outputs": [],
      "source": [
        "def make_Qmodel_linearRegression():\n",
        "  return LinearRegression()\n",
        "\n",
        "Qmodel_LinearRegression = make_Qmodel_linearRegression()\n",
        "\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "gcyeKSydAr4w"
      },
      "source": [
        "## Q model with XGBoost "
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 8,
      "metadata": {
        "id": "5hiMWUOgAsMd"
      },
      "outputs": [],
      "source": [
        "def make_Qmodel_XGBoost():\n",
        "  return XGBRegressor(n_jobs=1, objective = \"reg:squarederror\", random_state=RANDOM_SEED)\n",
        "\n",
        "Qmodel_XGBRegressor = make_Qmodel_XGBoost()"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "pFykT_xgDXKK"
      },
      "source": [
        "## Sanity Check of Qmodel for various confounder conditions"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Confounders without Mediators"
      ],
      "metadata": {
        "id": "yIn7aRtIFeqR"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Qmodel_randomForest = make_Qmodel_randomForest()\n",
        "Qmodel_LinearRegression = make_Qmodel_linearRegression()\n",
        "Qmodel_XGBoost = make_Qmodel_XGBoost()\n",
        "\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "\n",
        "X_w_treatment = confounders_without_Mediator.copy()\n",
        "X_w_treatment[\"treatment\"] = treatment\n",
        "\n",
        "X_train, X_test, y_train, y_test = train_test_split(X_w_treatment, outcome, test_size=0.2)\n",
        "Qmodel_randomForest.fit(X_train, y_train)\n",
        "Qmodel_LinearRegression.fit(X_train, y_train)\n",
        "Qmodel_XGBoost.fit(X_train, y_train)\n",
        "y_pred_RF0 = Qmodel_randomForest.predict(X_test)\n",
        "y_pred_LR0 = Qmodel_LinearRegression.predict(X_test)\n",
        "y_pred_XGB0 = Qmodel_XGBoost.predict(X_test)\n",
        "\n",
        "test_mse_RF0=mean_squared_error(y_pred_RF0, y_test)\n",
        "print(f\"Test MSE of fit model of RandomForest is {test_mse_RF0}\") \n",
        "test_mse_LR0=mean_squared_error(y_pred_LR0, y_test)\n",
        "print(f\"Test MSE of fit model of LogisticRegression is {test_mse_LR0}\")\n",
        "test_mse_XGB0=mean_squared_error(y_pred_XGB0, y_test)\n",
        "print(f\"Test MSE of fit model of XGBoost is {test_mse_XGB0}\")  \n",
        "baseline_mse_0=mean_squared_error(y_train.mean()*np.ones_like(y_test), y_test)\n",
        "print(f\"Test MSE of no-covariate model {baseline_mse_0}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "WxSl0LydFk5O",
        "outputId": "3f5e5b9c-0d23-48ea-875e-61502354a5c1"
      },
      "execution_count": 9,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Test MSE of fit model of RandomForest is 152.61182268502063\n",
            "Test MSE of fit model of LogisticRegression is 149.5181603180379\n",
            "Test MSE of fit model of XGBoost is 157.87593280805143\n",
            "Test MSE of no-covariate model 151.60195082882802\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Confounders with both mediators"
      ],
      "metadata": {
        "id": "ALvKeOdnG2Cb"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Qmodel_randomForest = make_Qmodel_randomForest()\n",
        "Qmodel_LinearRegression = make_Qmodel_linearRegression()\n",
        "Qmodel_XGBoost = make_Qmodel_XGBoost()\n",
        "\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "\n",
        "X_w_treatment = confounders_with_allMediators.copy()\n",
        "X_w_treatment[\"treatment\"] = treatment\n",
        "\n",
        "X_train, X_test, y_train, y_test = train_test_split(X_w_treatment, outcome, test_size=0.2)\n",
        "Qmodel_randomForest.fit(X_train, y_train)\n",
        "Qmodel_LinearRegression.fit(X_train, y_train)\n",
        "Qmodel_XGBoost.fit(X_train, y_train)\n",
        "y_pred_RF1 = Qmodel_randomForest.predict(X_test)\n",
        "y_pred_LR1 = Qmodel_LinearRegression.predict(X_test)\n",
        "y_pred_XGB1 = Qmodel_XGBoost.predict(X_test)\n",
        "\n",
        "test_mse_RF1=mean_squared_error(y_pred_RF1, y_test)\n",
        "print(f\"Test MSE of fit model of RandomForest is {test_mse_RF1}\") \n",
        "test_mse_LR1=mean_squared_error(y_pred_LR1, y_test)\n",
        "print(f\"Test MSE of fit model of LogisticRegression is {test_mse_LR1}\")\n",
        "test_mse_XGB1=mean_squared_error(y_pred_XGB1, y_test)\n",
        "print(f\"Test MSE of fit model of XGBoost is {test_mse_XGB1}\")  \n",
        "baseline_mse_1=mean_squared_error(y_train.mean()*np.ones_like(y_test), y_test)\n",
        "print(f\"Test MSE of no-covariate model {baseline_mse_1}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "OT-Q1HtuHZDR",
        "outputId": "8986a42a-39b3-4d4b-8021-84227198e138"
      },
      "execution_count": 10,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Test MSE of fit model of RandomForest is 169.40055899282586\n",
            "Test MSE of fit model of LogisticRegression is 168.51074769456227\n",
            "Test MSE of fit model of XGBoost is 181.72313659268914\n",
            "Test MSE of no-covariate model 182.09603897685102\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Confounders with Mediator StudyHours"
      ],
      "metadata": {
        "id": "syjSf3g8IKXP"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Qmodel_randomForest = make_Qmodel_randomForest()\n",
        "Qmodel_LinearRegression = make_Qmodel_linearRegression()\n",
        "Qmodel_XGBoost = make_Qmodel_XGBoost()\n",
        "\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "\n",
        "X_w_treatment = confounders_with_mediatorStudyHours.copy()\n",
        "X_w_treatment[\"treatment\"] = treatment\n",
        "\n",
        "X_train, X_test, y_train, y_test = train_test_split(X_w_treatment, outcome, test_size=0.2)\n",
        "Qmodel_randomForest.fit(X_train, y_train)\n",
        "Qmodel_LinearRegression.fit(X_train, y_train)\n",
        "Qmodel_XGBoost.fit(X_train, y_train)\n",
        "y_pred_RF2 = Qmodel_randomForest.predict(X_test)\n",
        "y_pred_LR2 = Qmodel_LinearRegression.predict(X_test)\n",
        "y_pred_XGB2 = Qmodel_XGBoost.predict(X_test)\n",
        "\n",
        "test_mse_RF2=mean_squared_error(y_pred_RF2, y_test)\n",
        "print(f\"Test MSE of fit model of RandomForest is {test_mse_RF2}\") \n",
        "test_mse_LR2=mean_squared_error(y_pred_LR2, y_test)\n",
        "print(f\"Test MSE of fit model of LogisticRegression is {test_mse_LR2}\")\n",
        "test_mse_XGB2=mean_squared_error(y_pred_XGB2, y_test)\n",
        "print(f\"Test MSE of fit model of XGBoost is {test_mse_XGB2}\")  \n",
        "baseline_mse_2=mean_squared_error(y_train.mean()*np.ones_like(y_test), y_test)\n",
        "print(f\"Test MSE of no-covariate model {baseline_mse_2}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "nqe87OyZIPlm",
        "outputId": "5183a9a0-b284-41df-df2b-237c1fbbe1e7"
      },
      "execution_count": 11,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Test MSE of fit model of RandomForest is 121.74053510688145\n",
            "Test MSE of fit model of LogisticRegression is 121.5828640808898\n",
            "Test MSE of fit model of XGBoost is 127.01489908354753\n",
            "Test MSE of no-covariate model 130.43894336091265\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Confounders with Mediator StudyHabit"
      ],
      "metadata": {
        "id": "Pa5OA-KfIntI"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Qmodel_randomForest = make_Qmodel_randomForest()\n",
        "Qmodel_LinearRegression = make_Qmodel_linearRegression()\n",
        "Qmodel_XGBoost = make_Qmodel_XGBoost()\n",
        "\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "\n",
        "X_w_treatment = confounders_with_mediatorStudyHabits.copy()\n",
        "X_w_treatment[\"treatment\"] = treatment\n",
        "\n",
        "X_train, X_test, y_train, y_test = train_test_split(X_w_treatment, outcome, test_size=0.2)\n",
        "Qmodel_randomForest.fit(X_train, y_train)\n",
        "Qmodel_LinearRegression.fit(X_train, y_train)\n",
        "Qmodel_XGBoost.fit(X_train, y_train)\n",
        "y_pred_RF3 = Qmodel_randomForest.predict(X_test)\n",
        "y_pred_LR3 = Qmodel_LinearRegression.predict(X_test)\n",
        "y_pred_XGB3 = Qmodel_XGBoost.predict(X_test)\n",
        "\n",
        "test_mse_RF3=mean_squared_error(y_pred_RF3, y_test)\n",
        "print(f\"Test MSE of fit model of RandomForest is {test_mse_RF3}\") \n",
        "test_mse_LR3=mean_squared_error(y_pred_LR2, y_test)\n",
        "print(f\"Test MSE of fit model of LogisticRegression is {test_mse_LR3}\")\n",
        "test_mse_XGB3=mean_squared_error(y_pred_XGB3, y_test)\n",
        "print(f\"Test MSE of fit model of XGBoost is {test_mse_XGB3}\")  \n",
        "baseline_mse_3=mean_squared_error(y_train.mean()*np.ones_like(y_test), y_test)\n",
        "print(f\"Test MSE of no-covariate model {baseline_mse_3}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "dWkpOxNAIrRN",
        "outputId": "410a32e9-e2ef-41f9-ca9b-cb28ea11545c"
      },
      "execution_count": 12,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Test MSE of fit model of RandomForest is 146.63714648602019\n",
            "Test MSE of fit model of LogisticRegression is 160.54813326298006\n",
            "Test MSE of fit model of XGBoost is 155.39814844985017\n",
            "Test MSE of no-covariate model 149.82793023432893\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "-jKu1MwyCdCC"
      },
      "source": [
        "## g model"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "0eaO1Oi3DS8I"
      },
      "source": [
        "### g model with RandomForest"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 16,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 53
        },
        "id": "uq6eZEBXbsaI",
        "outputId": "f0980ea5-11fb-4d3b-b04b-9dc204c01bf3"
      },
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "'\\n# Sanity check of confounders with mediators\\nX_train, X_test, a_train, a_test = train_test_split(confounders_with_Mediators, treatment, test_size=0.2)\\ngmodel.fit(X_train, a_train)\\na_pred = gmodel.predict_proba(X_test)[:,1]\\n\\ntest_ce=log_loss(a_test, a_pred)\\nprint(f\"Test CE of fit model {test_ce}\") \\nbaseline_ce=log_loss(a_test, a_train.mean()*np.ones_like(a_test))\\nprint(f\"Test CE of no-covariate model {baseline_ce}\")\\n'"
            ],
            "application/vnd.google.colaboratory.intrinsic+json": {
              "type": "string"
            }
          },
          "metadata": {},
          "execution_count": 16
        }
      ],
      "source": [
        "# specify a model for the propensity score\n",
        "\n",
        "def make_gmodel_randomForest():\n",
        "\n",
        "  return RandomForestClassifier(random_state=RANDOM_SEED, n_estimators=500, max_depth=3)\n",
        "\n",
        "gmodel_randomForest = make_gmodel_randomForest()\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "'''\n",
        "# Sanity check of confounders with mediators\n",
        "X_train, X_test, a_train, a_test = train_test_split(confounders_with_Mediators, treatment, test_size=0.2)\n",
        "gmodel.fit(X_train, a_train)\n",
        "a_pred = gmodel.predict_proba(X_test)[:,1]\n",
        "\n",
        "test_ce=log_loss(a_test, a_pred)\n",
        "print(f\"Test CE of fit model {test_ce}\") \n",
        "baseline_ce=log_loss(a_test, a_train.mean()*np.ones_like(a_test))\n",
        "print(f\"Test CE of no-covariate model {baseline_ce}\")\n",
        "'''"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "4X3sCNeyC6K0"
      },
      "source": [
        "### g model with logistic regression"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 13,
      "metadata": {
        "id": "dV-pn9FXJrDX"
      },
      "outputs": [],
      "source": [
        "def make_gmodel_logisticRegression():\n",
        "  return LogisticRegression(max_iter=1000)\n",
        "\n",
        "gmodel_LogisticRegression = make_gmodel_logisticRegression()"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "O-DrXpsQJrW6"
      },
      "source": [
        "### g model with XGBoost"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 14,
      "metadata": {
        "id": "7iX9s1VrJriP"
      },
      "outputs": [],
      "source": [
        "def make_gmodel_XGBClassifier():\n",
        "  return XGBClassifier(use_label_encoder=False, n_jobs=1, objective='binary:logistic',eval_metric = 'logloss', random_state =RANDOM_SEED)\n",
        "\n",
        "gmodel_XGBClassifier = make_gmodel_XGBClassifier()"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "oYvqsja_dhUj"
      },
      "source": [
        "## Sanity Check of gmodel for Various Confounding Conditions"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Confounder without Mediators"
      ],
      "metadata": {
        "id": "dm3smeI_JvjZ"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "gmodel_randomForest = make_gmodel_randomForest()\n",
        "gmodel_LogisticRegression = make_gmodel_logisticRegression()\n",
        "gmodel_XGBoost = make_gmodel_XGBClassifier()\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "\n",
        "# Sanity check of confounders with mediators\n",
        "X_train, X_test, a_train, a_test = train_test_split(confounders_without_Mediator, treatment, test_size=0.2)\n",
        "gmodel_randomForest.fit(X_train, a_train)\n",
        "gmodel_LogisticRegression.fit(X_train, a_train)\n",
        "gmodel_XGBoost.fit(X_train, a_train)\n",
        "a_pred_RF0 = gmodel_randomForest.predict_proba(X_test)[:,1]\n",
        "a_pred_LR0 = gmodel_LogisticRegression.predict_proba(X_test)[:,1]\n",
        "a_pred_XGB0 = gmodel_XGBoost.predict_proba(X_test)[:,1]\n",
        "\n",
        "test_ce_RF0=log_loss(a_test, a_pred_RF0)\n",
        "print(f\"Test CE of fit model {test_ce_RF0}\") \n",
        "test_ce_LR0=log_loss(a_test, a_pred_LR0)\n",
        "print(f\"Test CE of fit model {test_ce_LR0}\") \n",
        "test_ce_XGB0=log_loss(a_test, a_pred_XGB0)\n",
        "print(f\"Test CE of fit model {test_ce_XGB0}\") \n",
        "baseline_ce_0=log_loss(a_test, a_train.mean()*np.ones_like(a_test))\n",
        "print(f\"Test CE of no-covariate model {baseline_ce_0}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "gG5Whi0IJqSt",
        "outputId": "5d781ce4-d144-48a6-d73e-fbfd4af20168"
      },
      "execution_count": 17,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Test CE of fit model 0.6969537907441002\n",
            "Test CE of fit model 0.6901815757070059\n",
            "Test CE of fit model 0.7148464357400958\n",
            "Test CE of no-covariate model 0.6928663894825309\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Confounder with both Mediators"
      ],
      "metadata": {
        "id": "lTTtyfljKehy"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "gmodel_randomForest = make_gmodel_randomForest()\n",
        "gmodel_LogisticRegression = make_gmodel_logisticRegression()\n",
        "gmodel_XGBoost = make_gmodel_XGBClassifier()\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "\n",
        "# Sanity check of confounders with mediators\n",
        "X_train, X_test, a_train, a_test = train_test_split(confounders_with_allMediators, treatment, test_size=0.2)\n",
        "gmodel_randomForest.fit(X_train, a_train)\n",
        "gmodel_LogisticRegression.fit(X_train, a_train)\n",
        "gmodel_XGBoost.fit(X_train, a_train)\n",
        "a_pred_RF1 = gmodel_randomForest.predict_proba(X_test)[:,1]\n",
        "a_pred_LR1 = gmodel_LogisticRegression.predict_proba(X_test)[:,1]\n",
        "a_pred_XGB1 = gmodel_XGBoost.predict_proba(X_test)[:,1]\n",
        "\n",
        "test_ce_RF1=log_loss(a_test, a_pred_RF1)\n",
        "print(f\"Test CE of fit model {test_ce_RF1}\") \n",
        "test_ce_LR1=log_loss(a_test, a_pred_LR1)\n",
        "print(f\"Test CE of fit model {test_ce_LR1}\") \n",
        "test_ce_XGB1=log_loss(a_test, a_pred_XGB1)\n",
        "print(f\"Test CE of fit model {test_ce_XGB1}\") \n",
        "baseline_ce_1=log_loss(a_test, a_train.mean()*np.ones_like(a_test))\n",
        "print(f\"Test CE of no-covariate model {baseline_ce_1}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "aPxmmAFuKiKr",
        "outputId": "9998a7e2-ac46-4853-ac79-0e84417442b0"
      },
      "execution_count": 18,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Test CE of fit model 0.6825371285020937\n",
            "Test CE of fit model 0.6772843801502143\n",
            "Test CE of fit model 0.7119531055197331\n",
            "Test CE of no-covariate model 0.6934184476415775\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Confounder with Mediator StudyHour"
      ],
      "metadata": {
        "id": "9w5AmJ3dK7rt"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "gmodel_randomForest = make_gmodel_randomForest()\n",
        "gmodel_LogisticRegression = make_gmodel_logisticRegression()\n",
        "gmodel_XGBoost = make_gmodel_XGBClassifier()\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "\n",
        "# Sanity check of confounders with mediators\n",
        "X_train, X_test, a_train, a_test = train_test_split(confounders_with_mediatorStudyHours, treatment, test_size=0.2)\n",
        "gmodel_randomForest.fit(X_train, a_train)\n",
        "gmodel_LogisticRegression.fit(X_train, a_train)\n",
        "gmodel_XGBoost.fit(X_train, a_train)\n",
        "a_pred_RF2 = gmodel_randomForest.predict_proba(X_test)[:,1]\n",
        "a_pred_LR2 = gmodel_LogisticRegression.predict_proba(X_test)[:,1]\n",
        "a_pred_XGB2 = gmodel_XGBoost.predict_proba(X_test)[:,1]\n",
        "\n",
        "test_ce_RF2=log_loss(a_test, a_pred_RF2)\n",
        "print(f\"Test CE of fit model {test_ce_RF2}\") \n",
        "test_ce_LR2=log_loss(a_test, a_pred_LR2)\n",
        "print(f\"Test CE of fit model {test_ce_LR2}\") \n",
        "test_ce_XGB2=log_loss(a_test, a_pred_XGB2)\n",
        "print(f\"Test CE of fit model {test_ce_XGB2}\") \n",
        "baseline_ce_2=log_loss(a_test, a_train.mean()*np.ones_like(a_test))\n",
        "print(f\"Test CE of no-covariate model {baseline_ce_2}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "WRsn0T8ALCP1",
        "outputId": "d518b51e-0beb-4918-f6f6-2bb43ff9a0a8"
      },
      "execution_count": 19,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Test CE of fit model 0.6881377317572264\n",
            "Test CE of fit model 0.6904460291819955\n",
            "Test CE of fit model 0.7074084740961898\n",
            "Test CE of no-covariate model 0.6931170637648455\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Confounder with Mediator StudyHabit"
      ],
      "metadata": {
        "id": "T8PyKhP8tw-M"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "gmodel_randomForest = make_gmodel_randomForest()\n",
        "gmodel_LogisticRegression = make_gmodel_logisticRegression()\n",
        "gmodel_XGBoost = make_gmodel_XGBClassifier()\n",
        "# Sanity check that chosen model actually improves test error\n",
        "# A real analysis should give substantial attention to model selection and validation \n",
        "\n",
        "# Sanity check of confounders with mediators\n",
        "X_train, X_test, a_train, a_test = train_test_split(confounders_with_mediatorStudyHabits, treatment, test_size=0.2)\n",
        "gmodel_randomForest.fit(X_train, a_train)\n",
        "gmodel_LogisticRegression.fit(X_train, a_train)\n",
        "gmodel_XGBoost.fit(X_train, a_train)\n",
        "a_pred_RF3 = gmodel_randomForest.predict_proba(X_test)[:,1]\n",
        "a_pred_LR3 = gmodel_LogisticRegression.predict_proba(X_test)[:,1]\n",
        "a_pred_XGB3 = gmodel_XGBoost.predict_proba(X_test)[:,1]\n",
        "\n",
        "test_ce_RF3=log_loss(a_test, a_pred_RF3)\n",
        "print(f\"Test CE of fit model {test_ce_RF3}\") \n",
        "test_ce_LR3=log_loss(a_test, a_pred_LR3)\n",
        "print(f\"Test CE of fit model {test_ce_LR3}\") \n",
        "test_ce_XGB3=log_loss(a_test, a_pred_XGB3)\n",
        "print(f\"Test CE of fit model {test_ce_XGB3}\") \n",
        "baseline_ce_3=log_loss(a_test, a_train.mean()*np.ones_like(a_test))\n",
        "print(f\"Test CE of no-covariate model {baseline_ce_3}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "DpJhj5SvtvWT",
        "outputId": "148c26e4-c6c6-49dc-ff50-6b3100b4e46f"
      },
      "execution_count": 20,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Test CE of fit model 0.6921129990910787\n",
            "Test CE of fit model 0.6934293132511458\n",
            "Test CE of fit model 0.7088466351631129\n",
            "Test CE of no-covariate model 0.6928663894825308\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "2RkvV_4_dFWo"
      },
      "source": [
        "## Use cross fitting to get get predicted outcomes and propensity scores for each unit"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 21,
      "metadata": {
        "id": "KA0AsEGJ_X3b"
      },
      "outputs": [],
      "source": [
        "# helper functions to implement the cross fitting\n",
        "\n",
        "def treatment_k_fold_fit_and_predict(make_model, X:pd.DataFrame, A:np.array, n_splits:int):\n",
        "    \"\"\"\n",
        "    Implements K fold cross-fitting for the model predicting the treatment A. \n",
        "    That is, \n",
        "    1. Split data into K folds\n",
        "    2. For each fold j, the model is fit on the other K-1 folds\n",
        "    3. The fitted model is used to make predictions for each data point in fold j\n",
        "    Returns an array containing the predictions  \n",
        "\n",
        "    Args:\n",
        "    model: function that returns sklearn model (which implements fit and predict_prob)\n",
        "    X: dataframe of variables to adjust for\n",
        "    A: array of treatments\n",
        "    n_splits: number of splits to use\n",
        "    \"\"\"\n",
        "    predictions = np.full_like(A, np.nan, dtype=float)\n",
        "    kf = StratifiedKFold(n_splits=n_splits, shuffle=True, random_state=RANDOM_SEED)\n",
        "    print(kf)\n",
        "    \n",
        "    for train_index, test_index in kf.split(X, A):\n",
        "      X_train = X.loc[train_index]\n",
        "      A_train = A.loc[train_index]\n",
        "      g = make_model()\n",
        "      g.fit(X_train, A_train)\n",
        "\n",
        "      # get predictions for split\n",
        "      predictions[test_index] = g.predict_proba(X.loc[test_index])[:, 1]\n",
        "\n",
        "    assert np.isnan(predictions).sum() == 0\n",
        "    return predictions\n",
        "\n",
        "\n",
        "def outcome_k_fold_fit_and_predict(make_model, X:pd.DataFrame, y:np.array, A:np.array, n_splits:int, output_type:str):\n",
        "    \"\"\"\n",
        "    Implements K fold cross-fitting for the model predicting the outcome Y. \n",
        "    That is, \n",
        "    1. Split data into K folds\n",
        "    2. For each fold j, the model is fit on the other K-1 folds\n",
        "    3. The fitted model is used to make predictions for each data point in fold j\n",
        "    Returns two arrays containing the predictions for all units untreated, all units treated  \n",
        "\n",
        "    Args:\n",
        "    model: function that returns sklearn model (that implements fit and either predict_prob or predict)\n",
        "    X: dataframe of variables to adjust for\n",
        "    y: array of outcomes\n",
        "    A: array of treatments\n",
        "    n_splits: number of splits to use\n",
        "    output_type: type of outcome, \"binary\" or \"continuous\"\n",
        "\n",
        "    \"\"\"\n",
        "    predictions0 = np.full_like(A, np.nan, dtype=float)\n",
        "    predictions1 = np.full_like(y, np.nan, dtype=float)\n",
        "    if output_type == 'binary':\n",
        "      kf = StratifiedKFold(n_splits=n_splits, shuffle=True, random_state=RANDOM_SEED)\n",
        "    elif output_type == 'continuous':\n",
        "      kf = KFold(n_splits=n_splits, shuffle=True, random_state=RANDOM_SEED)\n",
        "\n",
        "    # include the treatment as input feature\n",
        "    X_w_treatment = X.copy()\n",
        "    X_w_treatment[\"A\"] = A\n",
        "\n",
        "    # for predicting effect under treatment / control status for each data point \n",
        "    X0 = X_w_treatment.copy()\n",
        "    X0[\"A\"] = 0\n",
        "    X1 = X_w_treatment.copy()\n",
        "    X1[\"A\"] = 1\n",
        "\n",
        "    \n",
        "    for train_index, test_index in kf.split(X_w_treatment, y):\n",
        "      X_train = X_w_treatment.loc[train_index]\n",
        "      y_train = y.loc[train_index]\n",
        "      q = make_model()\n",
        "      q.fit(X_train, y_train)\n",
        "\n",
        "      if output_type =='binary':\n",
        "        predictions0[test_index] = q.predict_proba(X0.loc[test_index])[:, 1]\n",
        "        predictions1[test_index] = q.predict_proba(X1.loc[test_index])[:, 1]\n",
        "      elif output_type == 'continuous':\n",
        "        predictions0[test_index] = q.predict(X0.loc[test_index])\n",
        "        predictions1[test_index] = q.predict(X1.loc[test_index])\n",
        "\n",
        "    assert np.isnan(predictions0).sum() == 0\n",
        "    assert np.isnan(predictions1).sum() == 0\n",
        "    return predictions0, predictions1"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Exclude Predictions with Moderate Extroversion Level"
      ],
      "metadata": {
        "id": "EcXXfNo7Vsrp"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "def exclude_moderate(df):\n",
        "  df.drop(df.index[363:747], inplace=True)\n",
        "  return df"
      ],
      "metadata": {
        "id": "_Q7GMNHXVrkw"
      },
      "execution_count": 22,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "VNhM7URdgzQB"
      },
      "source": [
        "## Combine predicted values and data into estimate of ATU"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 23,
      "metadata": {
        "id": "J-vONC5ejwh2"
      },
      "outputs": [],
      "source": [
        "def att_aiptw(Q0, Q1, g, A, Y, prob_t=None):\n",
        "  \"\"\"\n",
        "  # Double ML estimator for the ATT\n",
        "  This uses the ATT specific scores, see equation 3.9 of https://www.econstor.eu/bitstream/10419/149795/1/869216953.pdf\n",
        "  \"\"\"\n",
        "\n",
        "  if prob_t is None:\n",
        "    prob_t = 1 - A.mean() # estimate marginal probability of treatment\n",
        "\n",
        "  tau_hat = (A*((1-g)/g)*(Y-Q1) - (1-A)*(Y-Q1)).mean()/ prob_t\n",
        "  \n",
        "  scores = (A*((1-g)/g)*(Y-Q1) - (1-A)*(Y-Q1) - tau_hat*(1-A)) / prob_t\n",
        "  n = Y.shape[0] # number of observations\n",
        "  std_hat = np.std(scores) / np.sqrt(n)\n",
        "\n",
        "  return tau_hat, std_hat\n"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 22,
      "metadata": {
        "id": "O_F5r0SSkzzK"
      },
      "outputs": [],
      "source": [
        "def ate_aiptw(Q0, Q1, g, A, Y, prob_t=None):\n",
        "  \"\"\"\n",
        "  # Double ML estimator for the ATE\n",
        "  \"\"\"\n",
        "\n",
        "  tau_hat = (Q1 - Q0 + A*(Y-Q1)/g - (1-A)*(Y-Q0)/(1-g)).mean()\n",
        "  \n",
        "  scores = Q1 - Q0 + A*(Y-Q1)/g - (1-A)*(Y-Q0)/(1-g) - tau_hat\n",
        "  n = Y.shape[0] # number of observations\n",
        "  std_hat = np.std(scores) / np.sqrt(n)\n",
        "\n",
        "  return tau_hat, std_hat\n"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "1PUtEGGzXSIQ"
      },
      "source": [
        "# Natural Direct Effect with two Mediators"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "65_HhISR8mtX"
      },
      "source": [
        "## Check Overlap Conditions 0<Pr(A =1 |𝐗 = x, M1 = m1, M2 = m2) < 1 using the three models"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 31,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 317
        },
        "id": "2wJF-GKy8twQ",
        "outputId": "8d93715e-2f60-457e-c9eb-2f0487a2ec83"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "Text(0.5, 1.0, 'Using RandomForest')"
            ]
          },
          "metadata": {},
          "execution_count": 31
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ],
      "source": [
        "#check the ovrlap conditions using randomForest\n",
        "#get the propensity score function\n",
        "g1 = treatment_k_fold_fit_and_predict(make_gmodel_randomForest, X=confounders_with_allMediators, A=treatment, n_splits=10)\n",
        "g1_ol = np.concatenate((g1[:364],g1[746:]))\n",
        "hist(g1_ol,density = True)\n",
        "plt.title(\"Using RandomForest\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 37,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 317
        },
        "id": "TAGbVxO3QeGr",
        "outputId": "b817dd25-54b4-424a-c06d-8eb96fec3179"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "Text(0.5, 1.0, 'Using Logistic Regression')"
            ]
          },
          "metadata": {},
          "execution_count": 37
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ],
      "source": [
        "#check the ovrlap conditions using Logistic Regression\n",
        "g2 = treatment_k_fold_fit_and_predict(make_gmodel_logisticRegression, X=confounders_with_allMediators, A=treatment, n_splits=10)\n",
        "g2_ol = np.concatenate((g2[:364],g2[746:]))\n",
        "hist(g2_ol,density = True)\n",
        "plt.title(\"Using Logistic Regression\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 38,
      "metadata": {
        "id": "grGefcHXX4ni",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 317
        },
        "outputId": "643076ab-cf4d-4ffe-b159-d4921adbe196"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "Text(0.5, 1.0, 'Using Logistic Regression')"
            ]
          },
          "metadata": {},
          "execution_count": 38
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ],
      "source": [
        "#check the ovrlap conditions using XGBoost\n",
        "g3 = treatment_k_fold_fit_and_predict(make_gmodel_XGBClassifier, X=confounders_with_allMediators, A=treatment, n_splits=10)\n",
        "g3_ol = np.concatenate((g3[:364],g3[746:]))\n",
        "hist(g3_ol, density=True)\n",
        "plt.title(\"Using Logistic Regression\")"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "hist(g1_ol,density = True)\n",
        "hist(g2_ol,density = True)\n",
        "hist(g3_ol,density = True)\n",
        "plt.show()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 266
        },
        "id": "E9GR4Xmu--0V",
        "outputId": "880cc7cb-9e53-4469-8b1b-f30858b99fb3"
      },
      "execution_count": 36,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "fig, ax = plt.subplots(1, 3, figsize=(21,5))\n",
        "ax[0].hist(g1_ol,density = True)\n",
        "ax[0].set_title(\"Using RandomForest\")\n",
        "ax[1].hist(g2_ol,density = True)\n",
        "ax[1].set_title(\"Using Logistic Regression\")\n",
        "ax[2].hist(g3_ol,density = True)\n",
        "ax[2].set_title(\"Using XGBoost\")\n",
        "plt.show()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 336
        },
        "id": "um0Vi5Jz1DQF",
        "outputId": "e3a45e98-317a-407f-f099-38bc34a57d93"
      },
      "execution_count": 42,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 1512x360 with 3 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "pswwyh7Eltqc"
      },
      "source": [
        "## Calculate Natural Direct Effect with two mediators using RandomForest"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "5PdLq_g6pdZE"
      },
      "source": [
        "### Calculate Q0 and Q1 model using Random Forest"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 28,
      "metadata": {
        "id": "b54BFwwSl9pl"
      },
      "outputs": [],
      "source": [
        "#calculate Q0 and Q1 model\n",
        "Q0_RF,Q1_RF = outcome_k_fold_fit_and_predict(make_Qmodel_randomForest, X=confounders_with_allMediators, y=outcome, A=treatment, n_splits=10, output_type=\"continuous\")\n",
        "#Q0_RF"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "YLIVzDWno0FW"
      },
      "source": [
        "### Combine the Dataset for g, Q0, Q1, A, and Y values"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 29,
      "metadata": {
        "id": "YHZOhZvKoyVH",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "outputId": "b6cab719-61f8-4293-d1c3-58b6f0eb4dbe"
      },
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.402782  72.299124  71.960764  0  77.000000\n",
              "1  0.336636  68.104021  67.523853  0  73.666664\n",
              "2  0.469887  72.793072  72.421547  0  70.000000\n",
              "3  0.393366  73.574458  73.066637  0  81.000000\n",
              "4  0.438056  74.199206  73.974197  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-af5dc112-d811-4ed3-96d5-d3ccf194a87a\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.402782</td>\n",
              "      <td>72.299124</td>\n",
              "      <td>71.960764</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.336636</td>\n",
              "      <td>68.104021</td>\n",
              "      <td>67.523853</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.469887</td>\n",
              "      <td>72.793072</td>\n",
              "      <td>72.421547</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.393366</td>\n",
              "      <td>73.574458</td>\n",
              "      <td>73.066637</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.438056</td>\n",
              "      <td>74.199206</td>\n",
              "      <td>73.974197</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-af5dc112-d811-4ed3-96d5-d3ccf194a87a')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-af5dc112-d811-4ed3-96d5-d3ccf194a87a button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-af5dc112-d811-4ed3-96d5-d3ccf194a87a');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 29
        }
      ],
      "source": [
        "data_and_nuisance_estimates_RF = exclude_moderate(pd.DataFrame({'g': g1, 'Q0': Q0_RF, 'Q1': Q1_RF, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_RF.head()"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "P16hVRw5pig7"
      },
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "ZCLFLNnzphy1",
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "outputId": "8c45ccb0-7342-4ba5-8acb-32715644c6ae"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using RandomForest is -1.8229251600760765 pm 1.6028959659873445\n"
          ]
        }
      ],
      "source": [
        "tau_hat_RF, std_hat_RF = att_aiptw(**data_and_nuisance_estimates_RF)\n",
        "print(f\"The estimate using RandomForest is {tau_hat_RF} pm {1.96*std_hat_RF}\")"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Calculate Natural Direct Effect with two mediators using Logistic Regression"
      ],
      "metadata": {
        "id": "4rFe-TQcqwj8"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Q0 and Q1 model using Logistic Regression"
      ],
      "metadata": {
        "id": "_6gUluB-rfwN"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_LR,Q1_LR = outcome_k_fold_fit_and_predict(make_Qmodel_linearRegression, X=confounders_with_allMediators, y=outcome, A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "NbWUe3dCqu4q"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Combine the dataset for g, Q0, Q1, A, and Y values"
      ],
      "metadata": {
        "id": "SfQwRfbmsAAy"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_LR = exclude_moderate(pd.DataFrame({'g': g2, 'Q0': Q0_LR, 'Q1': Q1_LR, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_LR.head()"
      ],
      "metadata": {
        "id": "jgXteqcxsQo1",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "outputId": "f74baebe-309e-4122-e38f-5fe99d80cbeb"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.367456  74.400815  72.369989  0  77.000000\n",
              "1  0.367775  65.763319  64.326119  0  73.666664\n",
              "2  0.489072  68.645615  67.065967  0  70.000000\n",
              "3  0.261071  78.606101  77.026453  0  81.000000\n",
              "4  0.450896  74.054152  72.637679  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-e16ce3c6-6edf-470f-b69f-d0bac6bdce64\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.367456</td>\n",
              "      <td>74.400815</td>\n",
              "      <td>72.369989</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.367775</td>\n",
              "      <td>65.763319</td>\n",
              "      <td>64.326119</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.489072</td>\n",
              "      <td>68.645615</td>\n",
              "      <td>67.065967</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.261071</td>\n",
              "      <td>78.606101</td>\n",
              "      <td>77.026453</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.450896</td>\n",
              "      <td>74.054152</td>\n",
              "      <td>72.637679</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-e16ce3c6-6edf-470f-b69f-d0bac6bdce64')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-e16ce3c6-6edf-470f-b69f-d0bac6bdce64 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-e16ce3c6-6edf-470f-b69f-d0bac6bdce64');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 191
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ],
      "metadata": {
        "id": "BrMCaZL9sa5U"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_LR, std_hat_LR = att_aiptw(**data_and_nuisance_estimates_LR)\n",
        "print(f\"The estimate using RandomForest is {tau_hat_LR} pm {1.96*std_hat_LR}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "pwKVGTpUsgIO",
        "outputId": "0f8c5475-d96f-472e-ed55-5336023432af"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using RandomForest is -1.7545830996293097 pm 1.6116906687275725\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Calculate the Natural Direct Effect with two Mediators using XGBoost model"
      ],
      "metadata": {
        "id": "7Mz72YvHtE7r"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Q0 and Q1 model using XGBoost"
      ],
      "metadata": {
        "id": "xGBYzxtBtg72"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_XGB,Q1_XGB = outcome_k_fold_fit_and_predict(make_Qmodel_XGBoost, X=confounders_with_allMediators, y=outcome, A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "6EnXGFwUtOYW"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Combine the dataset for g, Q0, Q1, A, and Y values"
      ],
      "metadata": {
        "id": "NZdRyegdtdKt"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_XGB = exclude_moderate(pd.DataFrame({'g': g3, 'Q0': Q0_XGB, 'Q1': Q1_XGB, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_XGB.head()"
      ],
      "metadata": {
        "id": "OxZj4xFntvdy",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "outputId": "3313e29d-c520-4953-b6d5-ef943c45797a"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.227087  77.488861  75.122292  0  77.000000\n",
              "1  0.199275  66.383614  62.081127  0  73.666664\n",
              "2  0.440174  72.696465  70.747185  0  70.000000\n",
              "3  0.622674  70.690514  69.941917  0  81.000000\n",
              "4  0.290809  75.049919  73.602463  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-e77e4fbe-7c0c-4ff2-a9d7-6663ac6e3c0c\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.227087</td>\n",
              "      <td>77.488861</td>\n",
              "      <td>75.122292</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.199275</td>\n",
              "      <td>66.383614</td>\n",
              "      <td>62.081127</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.440174</td>\n",
              "      <td>72.696465</td>\n",
              "      <td>70.747185</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.622674</td>\n",
              "      <td>70.690514</td>\n",
              "      <td>69.941917</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.290809</td>\n",
              "      <td>75.049919</td>\n",
              "      <td>73.602463</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-e77e4fbe-7c0c-4ff2-a9d7-6663ac6e3c0c')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-e77e4fbe-7c0c-4ff2-a9d7-6663ac6e3c0c button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-e77e4fbe-7c0c-4ff2-a9d7-6663ac6e3c0c');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 194
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ],
      "metadata": {
        "id": "6IFD_uhvtrU9"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_XGB, std_hat_XGB = att_aiptw(**data_and_nuisance_estimates_XGB)\n",
        "print(f\"The estimate using RandomForest is {tau_hat_XGB} pm {1.96*std_hat_XGB}\")"
      ],
      "metadata": {
        "id": "fAP289gxuP7X",
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "outputId": "6a27130f-dc3b-4c74-f348-c008c0586447"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using RandomForest is -2.3732965265579797 pm 2.5775501827258482\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "r5tVJ3-qvccX"
      },
      "source": [
        "# Natural Direct Effect with StudyHours as the mediator"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "vzrTOVNtvccX"
      },
      "source": [
        "## Check Overlap Conditions 0<Pr(A =1 |𝐗 = x, M1 = m1) < 1 using the three models"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 43,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 390
        },
        "outputId": "1a098610-3577-4f47-f33b-533efbae6ce1",
        "id": "z-lbBRKJvccX"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([ 0.09635056,  0.33722697,  1.25255733,  2.55328994,  4.33577537,\n",
              "         9.63505638, 10.98396427,  1.73431015,  1.10803148,  0.28905169]),\n",
              " array([0.31562682, 0.34656204, 0.37749726, 0.40843248, 0.4393677 ,\n",
              "        0.47030292, 0.50123814, 0.53217336, 0.56310858, 0.5940438 ,\n",
              "        0.62497902]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 43
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ],
      "source": [
        "#check the overlap conditions using randomForest\n",
        "#get the propensity score function\n",
        "g1_SH = treatment_k_fold_fit_and_predict(make_gmodel_randomForest, X=confounders_with_mediatorStudyHours, A=treatment, n_splits=10)\n",
        "g1_SH_ol = np.concatenate((g1_SH[:364],g1_SH[746:]))\n",
        "hist(g1_SH_ol, density=True)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 44,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 391
        },
        "outputId": "f1ad366b-1f39-4f2e-ae8d-9935fd6b3642",
        "id": "qs3EjUetvccY"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([0.16586695, 0.24880043, 0.62200108, 2.15627041, 4.02227366,\n",
              "        5.51507625, 6.75907841, 6.09561059, 1.74160303, 0.49760086]),\n",
              " array([0.27255243, 0.30849239, 0.34443235, 0.38037231, 0.41631227,\n",
              "        0.45225223, 0.48819219, 0.52413215, 0.56007211, 0.59601207,\n",
              "        0.63195204]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 44
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ],
      "source": [
        "#check the overlap conditions using Logistic Regression\n",
        "g2_SH = treatment_k_fold_fit_and_predict(make_gmodel_logisticRegression, X=confounders_with_mediatorStudyHours, A=treatment, n_splits=10)\n",
        "g2_SH_ol = np.concatenate((g2_SH[:364],g2_SH[746:]))\n",
        "hist(g2_SH_ol, density=True)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 45,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 393
        },
        "outputId": "387acb87-6eb4-45db-8afb-4e9eb6966e19",
        "id": "Fky2lWR4vccY"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([0.03539834, 0.19469085, 0.46017837, 1.06195009, 2.58407855,\n",
              "        3.84071948, 2.49558271, 0.7787634 , 0.31858503, 0.10619501]),\n",
              " array([0.03583595, 0.12003838, 0.20424081, 0.28844324, 0.37264567,\n",
              "        0.4568481 , 0.54105053, 0.62525296, 0.70945539, 0.79365782,\n",
              "        0.87786025]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 45
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ],
      "source": [
        "#check the ovrlap conditions using XGBoost\n",
        "g3_SH = treatment_k_fold_fit_and_predict(make_gmodel_XGBClassifier, X=confounders_with_mediatorStudyHours, A=treatment, n_splits=10)\n",
        "g3_SH_ol = np.concatenate((g3_SH[:364],g3_SH[746:]))\n",
        "hist(g3_SH_ol, density=True)"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "fig, ax = plt.subplots(1, 3, figsize=(21,5))\n",
        "ax[0].hist(g1_SH_ol,density = True)\n",
        "ax[0].set_title(\"Using RandomForest\")\n",
        "ax[1].hist(g2_SH_ol,density = True)\n",
        "ax[1].set_title(\"Using Logistic Regression\")\n",
        "ax[2].hist(g3_SH_ol,density = True)\n",
        "ax[2].set_title(\"Using XGBoost\")\n",
        "plt.show()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 336
        },
        "id": "a4tdkl8GBFnG",
        "outputId": "e19936a2-30ef-46f6-954c-dbb3d06fc320"
      },
      "execution_count": 46,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 1512x360 with 3 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "mUo3HEw7vccY"
      },
      "source": [
        "## Calculate Natural Direct Effect using RandomForest: Using StudyHours as the mediator"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "qimN2jQQvccY"
      },
      "source": [
        "### Calculate Q0 and Q1 model using Random Forest"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "id": "9FCg3QNLvccY"
      },
      "outputs": [],
      "source": [
        "# Calculate Q0 and Q1 model\n",
        "Q0_RFSH,Q1_RFSH = outcome_k_fold_fit_and_predict(make_Qmodel_randomForest, X=confounders_with_mediatorStudyHours, y=outcome, A=treatment, n_splits=10, output_type=\"continuous\")"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "HJS5fNTRvccY"
      },
      "source": [
        "### Combine the Dataset for g, Q0, Q1, A, and Y values"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "outputId": "69e123ee-1228-47e0-81a0-2b2ea94cb81e",
        "id": "GGvlefq3vccY"
      },
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.405798  72.627219  72.246202  0  77.000000\n",
              "1  0.349164  67.910706  67.193627  0  73.666664\n",
              "2  0.467157  72.367704  71.957374  0  70.000000\n",
              "3  0.395640  73.347364  72.649354  0  81.000000\n",
              "4  0.487912  74.291248  74.006197  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-8e19a3d2-0d38-441d-a70c-c685305af268\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.405798</td>\n",
              "      <td>72.627219</td>\n",
              "      <td>72.246202</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.349164</td>\n",
              "      <td>67.910706</td>\n",
              "      <td>67.193627</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.467157</td>\n",
              "      <td>72.367704</td>\n",
              "      <td>71.957374</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.395640</td>\n",
              "      <td>73.347364</td>\n",
              "      <td>72.649354</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.487912</td>\n",
              "      <td>74.291248</td>\n",
              "      <td>74.006197</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-8e19a3d2-0d38-441d-a70c-c685305af268')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-8e19a3d2-0d38-441d-a70c-c685305af268 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-8e19a3d2-0d38-441d-a70c-c685305af268');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 200
        }
      ],
      "source": [
        "data_and_nuisance_estimates_RFSH = exclude_moderate(pd.DataFrame({'g': g1_SH, 'Q0': Q0_RFSH, 'Q1': Q1_RFSH, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_RFSH.head()"
      ]
    },
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "my5fFYv7vccZ"
      },
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "outputId": "69b3073d-94e9-49e4-a144-a8bfce84dd45",
        "id": "y26GBnjdvccZ"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate is -1.8372531778586831 pm 1.6098985819739995\n"
          ]
        }
      ],
      "source": [
        "tau_hat_RFSH, std_hat_RFSH = att_aiptw(**data_and_nuisance_estimates_RFSH)\n",
        "print(f\"The estimate is {tau_hat_RFSH} pm {1.96*std_hat_RFSH}\")"
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Calculate Natural Direct Effect using Logistic Regression: Using StudyHours as the mediator"
      ],
      "metadata": {
        "id": "wusfve4QvccZ"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Q0 and Q1 model using Logistic Regression"
      ],
      "metadata": {
        "id": "gpajpARxvccZ"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_LRSH,Q1_LRSH = outcome_k_fold_fit_and_predict(make_Qmodel_linearRegression, X=confounders_with_mediatorStudyHours, y=outcome, A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "l53YzxSVvccZ"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Combine the dataset for g, Q0, Q1, A, and Y values"
      ],
      "metadata": {
        "id": "kopNcIoAvccZ"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_LRSH = exclude_moderate(pd.DataFrame({'g': g2_SH, 'Q0': Q0_LRSH, 'Q1': Q1_LRSH, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_LRSH.head()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "outputId": "4bab21d5-5f63-4575-fa53-39c20aa9762e",
        "id": "C-eq2ZCdvccZ"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.407010  74.327267  72.283829  0  77.000000\n",
              "1  0.380085  65.705040  64.250488  0  73.666664\n",
              "2  0.539543  68.788454  67.227153  0  70.000000\n",
              "3  0.310189  78.884170  77.322870  0  81.000000\n",
              "4  0.522647  73.766872  72.331557  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-c0674216-73ac-46cb-99b6-abe5055ab5cc\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.407010</td>\n",
              "      <td>74.327267</td>\n",
              "      <td>72.283829</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.380085</td>\n",
              "      <td>65.705040</td>\n",
              "      <td>64.250488</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.539543</td>\n",
              "      <td>68.788454</td>\n",
              "      <td>67.227153</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.310189</td>\n",
              "      <td>78.884170</td>\n",
              "      <td>77.322870</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.522647</td>\n",
              "      <td>73.766872</td>\n",
              "      <td>72.331557</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c0674216-73ac-46cb-99b6-abe5055ab5cc')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-c0674216-73ac-46cb-99b6-abe5055ab5cc button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-c0674216-73ac-46cb-99b6-abe5055ab5cc');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 203
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ],
      "metadata": {
        "id": "HjHBw0CbvccZ"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_LRSH, std_hat_LRSH = att_aiptw(**data_and_nuisance_estimates_LRSH)\n",
        "print(f\"The estimate is {tau_hat_LRSH} pm {1.96*std_hat_LRSH}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "outputId": "be2f2ad5-b41d-4cde-96d3-3f6025cf06cf",
        "id": "6oxU2fRdvccZ"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate is -1.6982852478109984 pm 1.5987121171258265\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Calculate the Natural Direct Effect using XGBoost model: Using StudyHours as the Mediator"
      ],
      "metadata": {
        "id": "khunWu9-vcca"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Q0 and Q1 model using XGBoost"
      ],
      "metadata": {
        "id": "MiyobKXivcca"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_XGSH,Q1_XGSH = outcome_k_fold_fit_and_predict(make_Qmodel_XGBoost, X=confounders_with_mediatorStudyHours, y=outcome, A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "TLYnmWPdvcca"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Combine the dataset for g, Q0, Q1, A, and Y values"
      ],
      "metadata": {
        "id": "ztWQif2Tvcca"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_XGSH = exclude_moderate(pd.DataFrame({'g': g3_SH, 'Q0': Q0_XGSH, 'Q1': Q1_XGSH, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_XGSH.head()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "outputId": "530b6044-5cce-4d92-d631-2832efea130a",
        "id": "SA3MUED-vcca"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.278625  77.259163  74.763947  0  77.000000\n",
              "1  0.200761  66.603958  59.280952  0  73.666664\n",
              "2  0.520494  72.521431  69.231903  0  70.000000\n",
              "3  0.596783  66.622696  66.040443  0  81.000000\n",
              "4  0.431568  75.098595  74.831985  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-5ac21566-f858-48ab-a771-4254f1918054\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.278625</td>\n",
              "      <td>77.259163</td>\n",
              "      <td>74.763947</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.200761</td>\n",
              "      <td>66.603958</td>\n",
              "      <td>59.280952</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.520494</td>\n",
              "      <td>72.521431</td>\n",
              "      <td>69.231903</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.596783</td>\n",
              "      <td>66.622696</td>\n",
              "      <td>66.040443</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.431568</td>\n",
              "      <td>75.098595</td>\n",
              "      <td>74.831985</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-5ac21566-f858-48ab-a771-4254f1918054')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-5ac21566-f858-48ab-a771-4254f1918054 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-5ac21566-f858-48ab-a771-4254f1918054');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 206
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ],
      "metadata": {
        "id": "xXIpsBenvcca"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_XGSH, std_hat_XGSH = att_aiptw(**data_and_nuisance_estimates_XGSH)\n",
        "print(f\"The estimate is {tau_hat_XGSH} pm {1.96*std_hat_XGSH}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "outputId": "46a751a9-a8de-46ac-c08b-12187a3c289d",
        "id": "FEy11J07vcca"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate is -2.571081234753055 pm 2.448954950217818\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "# Natural Direct Effect with Study Habits as the mediator"
      ],
      "metadata": {
        "id": "bNrqufm3ztjM"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Check Overlap Conditions 0<Pr(A =1 |𝐗 = x, M2 = m2) < 1 using the three models"
      ],
      "metadata": {
        "id": "BHGKPeJ7z3r_"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "#check the overlap conditions using randomForest\n",
        "#get the propensity score function\n",
        "g1_SB = treatment_k_fold_fit_and_predict(make_gmodel_randomForest, X=confounders_with_mediatorStudyHabits, A=treatment, n_splits=10)\n",
        "g1_SB_ol = np.concatenate((g1_SB[:364],g1_SB[746:]))                                      \n",
        "hist(g1_SB_ol, density=True)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 390
        },
        "id": "AKHGJ8ufzu-F",
        "outputId": "22cc5c61-a09a-47e2-9eea-068fd5ff41ec"
      },
      "execution_count": 47,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([ 0.08280973,  0.3726438 ,  1.07652653,  1.94602873,  3.93346233,\n",
              "        11.75898213,  6.50056406,  1.53198007,  0.4968584 ,  0.08280973]),\n",
              " array([0.29084165, 0.32683532, 0.36282898, 0.39882265, 0.43481632,\n",
              "        0.47080998, 0.50680365, 0.54279732, 0.57879098, 0.61478465,\n",
              "        0.65077832]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 47
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "g2_SB = treatment_k_fold_fit_and_predict(make_gmodel_logisticRegression, X=confounders_with_mediatorStudyHabits, \n",
        "                                      A=treatment, n_splits=10)\n",
        "g2_SB_ol = np.concatenate((g2_SB[:364],g1_SB[746:]))\n",
        "hist(g2_SB_ol, density=True)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 390
        },
        "id": "EkVIsseLzvEq",
        "outputId": "7c585d08-1420-4503-a578-e3086cb2a648"
      },
      "execution_count": 48,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([0.08027969, 0.56195786, 1.56545404, 2.32811114, 6.02097709,\n",
              "        8.58992731, 4.93720121, 2.1274119 , 0.56195786, 0.16055939]),\n",
              " array([0.29084165, 0.32796967, 0.36509769, 0.40222571, 0.43935372,\n",
              "        0.47648174, 0.51360976, 0.55073778, 0.58786579, 0.62499381,\n",
              "        0.66212183]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 48
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "g3_SB = treatment_k_fold_fit_and_predict(make_gmodel_XGBClassifier, X=confounders_with_mediatorStudyHabits, \n",
        "                                      A=treatment, n_splits=10)\n",
        "g3_SB_ol = np.concatenate((g3_SB[:364],g1_SB[746:]))\n",
        "hist(g3_SB_ol, density=True)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 390
        },
        "id": "OP0YN2ghzvsa",
        "outputId": "64aa80a2-3a14-484d-ab84-a2fb0d143082"
      },
      "execution_count": 49,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([0.22276885, 0.36453085, 0.60755141, 1.25560626, 4.03009105,\n",
              "        5.06292845, 1.43787168, 0.42528599, 0.10125857, 0.08100686]),\n",
              " array([0.12142241, 0.19501188, 0.26860136, 0.34219083, 0.41578031,\n",
              "        0.48936978, 0.56295925, 0.63654873, 0.7101382 , 0.78372768,\n",
              "        0.85731715]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 49
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "fig, ax = plt.subplots(1, 3, figsize=(21,5))\n",
        "ax[0].hist(g1_SB_ol,density = True)\n",
        "ax[0].set_title(\"Using RandomForest\")\n",
        "ax[1].hist(g2_SB_ol,density = True)\n",
        "ax[1].set_title(\"Using Logistic Regression\")\n",
        "ax[2].hist(g3_SB_ol,density = True)\n",
        "ax[2].set_title(\"Using XGBoost\")\n",
        "plt.show()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 336
        },
        "id": "9vP1tMVBBXLa",
        "outputId": "315d0c4e-1712-4203-c633-ec7245f811cc"
      },
      "execution_count": 50,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 1512x360 with 3 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Calculate Natural Direct Effect using RandomForest: Using Study Habits as the mediator"
      ],
      "metadata": {
        "id": "9nLcNeCvz_81"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Q0 and Q1 model using RandomForest"
      ],
      "metadata": {
        "id": "GsaTtDxg1Ws8"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_RFSB,Q1_RFSB = outcome_k_fold_fit_and_predict(make_Qmodel_randomForest, \n",
        "                                             X=confounders_with_mediatorStudyHabits, y=outcome, \n",
        "                                             A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "5IQjKO6m0AHN"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Combine the Dataset for g, Q0, Q1, A, and Y values"
      ],
      "metadata": {
        "id": "dyqay97i1Kb1"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_RFSB = exclude_moderate(pd.DataFrame({'g': g1_SB, 'Q0': Q0_RFSB, 'Q1': Q1_RFSB, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_RFSB.head()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "id": "xS4UGQTp0AQi",
        "outputId": "dff08d3a-56e9-4c1f-9e97-d184a4f483a3"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.396729  71.131685  70.508828  0  77.000000\n",
              "1  0.329397  67.594057  65.971519  0  73.666664\n",
              "2  0.506071  68.636775  68.209594  0  70.000000\n",
              "3  0.417467  69.222686  68.892401  0  81.000000\n",
              "4  0.430190  71.657158  71.619395  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-08850717-e434-4dad-b162-a779ad782510\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.396729</td>\n",
              "      <td>71.131685</td>\n",
              "      <td>70.508828</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.329397</td>\n",
              "      <td>67.594057</td>\n",
              "      <td>65.971519</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.506071</td>\n",
              "      <td>68.636775</td>\n",
              "      <td>68.209594</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.417467</td>\n",
              "      <td>69.222686</td>\n",
              "      <td>68.892401</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.430190</td>\n",
              "      <td>71.657158</td>\n",
              "      <td>71.619395</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-08850717-e434-4dad-b162-a779ad782510')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-08850717-e434-4dad-b162-a779ad782510 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-08850717-e434-4dad-b162-a779ad782510');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 212
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ],
      "metadata": {
        "id": "rkaOAkob1cCS"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_RFSB, std_hat_RFSB = att_aiptw(**data_and_nuisance_estimates_RFSB)\n",
        "print(f\"The estimate using RandomForest is {tau_hat_RFSB} pm {1.96*std_hat_RFSB}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "eRNjwenD0AY0",
        "outputId": "c14f8e60-c24d-444b-a0aa-efc6709b8d77"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using RandomForest is -2.114952277727547 pm 1.6311171760534149\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Calculate Natural Direct Effect using LogisticRegression: Using Study Habits as the mediator"
      ],
      "metadata": {
        "id": "9_qcNP9r0Miw"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Q0 and Q1 model using Logistic Regression"
      ],
      "metadata": {
        "id": "V08Cvsep1SGJ"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_LRSB,Q1_LRSB = outcome_k_fold_fit_and_predict(make_Qmodel_linearRegression, \n",
        "                                             X=confounders_with_mediatorStudyHabits, y=outcome, \n",
        "                                             A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "-PygHOPH0SXZ"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Combine the Dataset for g, Q0, Q1, A, and Y values"
      ],
      "metadata": {
        "id": "qA08ShfE1Ifv"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_LRSB = exclude_moderate(pd.DataFrame({'g': g2_SB, 'Q0': Q0_LRSB, 'Q1': Q1_LRSB, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_LRSB.head()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "id": "3wZhc3fK0SeG",
        "outputId": "d771d4bf-8b9e-4e81-dd92-ef3a5f38598c"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.398288  72.574095  70.301962  0  77.000000\n",
              "1  0.387782  64.772486  63.101131  0  73.666664\n",
              "2  0.538986  66.451156  64.611026  0  70.000000\n",
              "3  0.406636  69.112386  67.272256  0  81.000000\n",
              "4  0.487341  72.313546  70.693444  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-2188dfc9-c586-49e1-96e1-f20bb681237c\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.398288</td>\n",
              "      <td>72.574095</td>\n",
              "      <td>70.301962</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.387782</td>\n",
              "      <td>64.772486</td>\n",
              "      <td>63.101131</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.538986</td>\n",
              "      <td>66.451156</td>\n",
              "      <td>64.611026</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.406636</td>\n",
              "      <td>69.112386</td>\n",
              "      <td>67.272256</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.487341</td>\n",
              "      <td>72.313546</td>\n",
              "      <td>70.693444</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-2188dfc9-c586-49e1-96e1-f20bb681237c')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-2188dfc9-c586-49e1-96e1-f20bb681237c button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-2188dfc9-c586-49e1-96e1-f20bb681237c');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 215
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ],
      "metadata": {
        "id": "W0g50BEq1dnq"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_LRSB, std_hat_LRSB = att_aiptw(**data_and_nuisance_estimates_LRSB)\n",
        "print(f\"The estimate using LogisticRegression is {tau_hat_LRSB} pm {1.96*std_hat_LRSB}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "ePIUW3th0Smx",
        "outputId": "e94ca895-10a2-462c-eddf-e7cb85bc8f76"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using LogisticRegression is -2.0579612230360245 pm 1.631844226495338\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Calculate Natural Direct Effect using XGBoost: Using Study Habits as the mediator"
      ],
      "metadata": {
        "id": "iaseTssk0iMv"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Q0 and Q1 model using XGBoost"
      ],
      "metadata": {
        "id": "s3YYLOfD1Prq"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_XGSB,Q1_XGSB = outcome_k_fold_fit_and_predict(make_Qmodel_XGBoost, \n",
        "                                             X=confounders_with_mediatorStudyHabits, y=outcome, \n",
        "                                             A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "VggmGQj80iVq"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Combine the Dataset for g, Q0, Q1, A, and Y values"
      ],
      "metadata": {
        "id": "ivLLPIdt1HIl"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_XGSB = exclude_moderate(pd.DataFrame({'g': g3_SB, 'Q0': Q0_XGSB, 'Q1': Q1_XGSB, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_XGSB.head()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "id": "EZXtfvmF0icE",
        "outputId": "f2ce951f-0792-4113-de60-178e5d0c61a5"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.294540  74.226723  71.850433  0  77.000000\n",
              "1  0.258790  64.716011  59.577900  0  73.666664\n",
              "2  0.712588  68.861565  65.525139  0  70.000000\n",
              "3  0.440861  70.527634  69.541443  0  81.000000\n",
              "4  0.408167  70.058609  69.259811  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-8c46630c-f821-4bba-922c-f808ecee7f57\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.294540</td>\n",
              "      <td>74.226723</td>\n",
              "      <td>71.850433</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.258790</td>\n",
              "      <td>64.716011</td>\n",
              "      <td>59.577900</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.712588</td>\n",
              "      <td>68.861565</td>\n",
              "      <td>65.525139</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.440861</td>\n",
              "      <td>70.527634</td>\n",
              "      <td>69.541443</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.408167</td>\n",
              "      <td>70.058609</td>\n",
              "      <td>69.259811</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-8c46630c-f821-4bba-922c-f808ecee7f57')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-8c46630c-f821-4bba-922c-f808ecee7f57 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-8c46630c-f821-4bba-922c-f808ecee7f57');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 218
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate the Natural Direct Effect using the ATU formula"
      ],
      "metadata": {
        "id": "Lp5gKOQI1fb7"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_XGSB, std_hat_XGSB = att_aiptw(**data_and_nuisance_estimates_XGSB)\n",
        "print(f\"The estimate using XGBoost is {tau_hat_XGSB} pm {1.96*std_hat_XGSB}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "DIufAB540ili",
        "outputId": "bb9154cd-96ad-4646-b56d-931639a80e88"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using XGBoost is -2.8114767903316187 pm 2.388752939243781\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "# Estimate the Total Effect using ATE"
      ],
      "metadata": {
        "id": "fkKquN-J2SuD"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Check Overlap Conditions 0<Pr(A =1 |𝐗 = x, M1 = m1, M2 = m2) < 1 using the three models"
      ],
      "metadata": {
        "id": "qeWyAMFFgjmg"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "\n",
        "#get the propensity score function\n",
        "g1_TE = treatment_k_fold_fit_and_predict(make_gmodel_randomForest, X=confounders_without_Mediator, \n",
        "                                      A=treatment, n_splits=10)\n",
        "g1_TE_ol = np.concatenate((g1_TE[:364],g1_SB[746:]))\n",
        "hist(g1_TE_ol, density=True)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 390
        },
        "id": "469lxIHy4-e-",
        "outputId": "a67b39df-42a1-41e6-d6b7-82788adfde60"
      },
      "execution_count": 51,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([ 0.14786312,  0.73931559,  1.51559696,  1.21987072,  8.02157416,\n",
              "        10.75704184,  1.6264943 ,  0.62841825,  0.07393156,  0.07393156]),\n",
              " array([0.29084165, 0.33115767, 0.37147368, 0.4117897 , 0.45210572,\n",
              "        0.49242173, 0.53273775, 0.57305376, 0.61336978, 0.6536858 ,\n",
              "        0.69400181]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 51
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "g2_TE = treatment_k_fold_fit_and_predict(make_gmodel_logisticRegression, X=confounders_without_Mediator, \n",
        "                                      A=treatment, n_splits=10)\n",
        "g2_TE_ol = np.concatenate((g2_TE[:364],g1_SB[746:]))\n",
        "hist(g2_TE_ol, density=True)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 390
        },
        "id": "__lXH6BF5Nvc",
        "outputId": "14fb60cc-4644-44b2-c39e-493cf9e59296"
      },
      "execution_count": 52,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([ 0.09247878,  0.04623939,  0.3699151 ,  1.80333613,  3.69915103,\n",
              "         5.13257205, 12.9470286 ,  5.13257205,  1.43342102,  0.3699151 ]),\n",
              " array([0.29084165, 0.32307203, 0.35530241, 0.38753279, 0.41976316,\n",
              "        0.45199354, 0.48422392, 0.5164543 , 0.54868468, 0.58091506,\n",
              "        0.61314544]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 52
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "g3_TE = treatment_k_fold_fit_and_predict(make_gmodel_XGBClassifier, X=confounders_without_Mediator, \n",
        "                                      A=treatment, n_splits=10)\n",
        "g3_TE_ol = np.concatenate((g1_TE[:364],g1_SB[746:]))\n",
        "hist(g3_TE_ol, density=True)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 390
        },
        "id": "vSV9vGil5N7j",
        "outputId": "74a5c095-9fab-44ff-a412-b8736e522f76"
      },
      "execution_count": 53,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "StratifiedKFold(n_splits=10, random_state=42, shuffle=True)\n"
          ]
        },
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "(array([ 0.14786312,  0.73931559,  1.51559696,  1.21987072,  8.02157416,\n",
              "        10.75704184,  1.6264943 ,  0.62841825,  0.07393156,  0.07393156]),\n",
              " array([0.29084165, 0.33115767, 0.37147368, 0.4117897 , 0.45210572,\n",
              "        0.49242173, 0.53273775, 0.57305376, 0.61336978, 0.6536858 ,\n",
              "        0.69400181]),\n",
              " <a list of 10 Patch objects>)"
            ]
          },
          "metadata": {},
          "execution_count": 53
        },
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 432x288 with 1 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "fig, ax = plt.subplots(1, 3, figsize=(21,5))\n",
        "ax[0].hist(g1_TE_ol,density = True)\n",
        "ax[0].set_title(\"Using RandomForest\")\n",
        "ax[1].hist(g2_TE_ol,density = True)\n",
        "ax[1].set_title(\"Using Logistic Regression\")\n",
        "ax[2].hist(g3_TE_ol,density = True)\n",
        "ax[2].set_title(\"Using XGBoost\")\n",
        "plt.show()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 336
        },
        "id": "zgjVq39DBfwy",
        "outputId": "cc3abe3a-28d8-4feb-e635-a844cedaab29"
      },
      "execution_count": 54,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/plain": [
              "<Figure size 1512x360 with 3 Axes>"
            ],
            "image/png": "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\n"
          },
          "metadata": {
            "needs_background": "light"
          }
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Total Effect using RandomForest"
      ],
      "metadata": {
        "id": "Q_HJW-J15zq_"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_RFTE,Q1_RFTE = outcome_k_fold_fit_and_predict(make_Qmodel_randomForest, \n",
        "                                             X=confounders_without_Mediator, y=outcome, \n",
        "                                             A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "trLbDeNa58Q-"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_RFTE = exclude_moderate(pd.DataFrame({'g': g1_TE, 'Q0': Q0_RFTE, 'Q1': Q1_RFTE, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_RFTE.head()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "id": "uoORIJ3258pb",
        "outputId": "43c1b18c-5df2-4ec6-af6e-6ae7cb270c74"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.411958  71.186335  66.803693  0  77.000000\n",
              "1  0.337099  69.780694  66.104271  0  73.666664\n",
              "2  0.532632  70.325724  68.095118  0  70.000000\n",
              "3  0.360352  69.518177  67.319265  0  81.000000\n",
              "4  0.519409  72.097452  70.847277  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-dd5d0443-4056-4c48-9d5a-bd78b3aa9595\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.411958</td>\n",
              "      <td>71.186335</td>\n",
              "      <td>66.803693</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.337099</td>\n",
              "      <td>69.780694</td>\n",
              "      <td>66.104271</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.532632</td>\n",
              "      <td>70.325724</td>\n",
              "      <td>68.095118</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.360352</td>\n",
              "      <td>69.518177</td>\n",
              "      <td>67.319265</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.519409</td>\n",
              "      <td>72.097452</td>\n",
              "      <td>70.847277</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-dd5d0443-4056-4c48-9d5a-bd78b3aa9595')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-dd5d0443-4056-4c48-9d5a-bd78b3aa9595 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-dd5d0443-4056-4c48-9d5a-bd78b3aa9595');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 224
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_RFTE, std_hat_RFTE = att_aiptw(**data_and_nuisance_estimates_RFTE)\n",
        "print(f\"The estimate using RandomForest is {tau_hat_RFTE} pm {1.96*std_hat_RFTE}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "RRvEOQfl58x4",
        "outputId": "3faa90fe-2faf-4739-8b14-711692ad46dd"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using RandomForest is -2.2013651850537603 pm 1.6693509737724903\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Total Effect using Logistic Regression"
      ],
      "metadata": {
        "id": "tys7oUAQ50kW"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_LRTE,Q1_LRTE = outcome_k_fold_fit_and_predict(make_Qmodel_linearRegression, \n",
        "                                             X=confounders_without_Mediator, y=outcome, \n",
        "                                             A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "EQtboVhd6cuB"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_LRTE = exclude_moderate(pd.DataFrame({'g': g2_TE, 'Q0': Q0_LRTE, 'Q1': Q1_LRTE, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_LRTE.head()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "id": "1r-jXEPN6i9t",
        "outputId": "109a1be5-4a9a-4051-d3d8-d271276d770e"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.456252  69.044088  66.615084  0  77.000000\n",
              "1  0.403838  67.693013  65.866381  0  73.666664\n",
              "2  0.528368  70.077743  68.152090  0  70.000000\n",
              "3  0.421758  68.350808  66.425155  0  81.000000\n",
              "4  0.513315  71.925262  70.085348  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-8571e0a9-f45d-4fa7-9f66-e9d92f398e85\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.456252</td>\n",
              "      <td>69.044088</td>\n",
              "      <td>66.615084</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.403838</td>\n",
              "      <td>67.693013</td>\n",
              "      <td>65.866381</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.528368</td>\n",
              "      <td>70.077743</td>\n",
              "      <td>68.152090</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.421758</td>\n",
              "      <td>68.350808</td>\n",
              "      <td>66.425155</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.513315</td>\n",
              "      <td>71.925262</td>\n",
              "      <td>70.085348</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-8571e0a9-f45d-4fa7-9f66-e9d92f398e85')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-8571e0a9-f45d-4fa7-9f66-e9d92f398e85 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-8571e0a9-f45d-4fa7-9f66-e9d92f398e85');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 227
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_LRTE, std_hat_LRTE = att_aiptw(**data_and_nuisance_estimates_LRTE)\n",
        "print(f\"The estimate using Logistic Regression is {tau_hat_LRTE} pm {1.96*std_hat_LRTE}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "f-65NIKL6ot4",
        "outputId": "ab70c945-1b5c-4a67-b09c-aaad1b5ec0b2"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using Logistic Regression is -2.2091922486069926 pm 1.6352836765340613\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Calculate Total Effect using XGBoost"
      ],
      "metadata": {
        "id": "QMEDx8iq3cBJ"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "Q0_XGTE,Q1_XGTE = outcome_k_fold_fit_and_predict(make_Qmodel_XGBoost, \n",
        "                                             X=confounders_without_Mediator, y=outcome, \n",
        "                                             A=treatment, n_splits=10, output_type=\"continuous\")"
      ],
      "metadata": {
        "id": "AmPYr52T3ZH0"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "data_and_nuisance_estimates_XGTE = exclude_moderate(pd.DataFrame({'g': g3_TE, 'Q0': Q0_XGTE, 'Q1': Q1_XGTE, 'A': treatment, 'Y': outcome}))\n",
        "data_and_nuisance_estimates_XGTE.head()"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 206
        },
        "id": "55loX07Z3qJV",
        "outputId": "c7d75df9-2873-4166-ff94-470e7d04654c"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "          g         Q0         Q1  A          Y\n",
              "0  0.388895  72.064819  66.912010  0  77.000000\n",
              "1  0.325704  70.125023  65.910683  0  73.666664\n",
              "2  0.553644  71.329063  68.893646  0  70.000000\n",
              "3  0.368042  71.262108  66.487671  0  81.000000\n",
              "4  0.557024  72.482079  70.086472  0  81.500000"
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-86966ea2-81fb-4a22-972c-75d758dfbe29\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>g</th>\n",
              "      <th>Q0</th>\n",
              "      <th>Q1</th>\n",
              "      <th>A</th>\n",
              "      <th>Y</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>0</th>\n",
              "      <td>0.388895</td>\n",
              "      <td>72.064819</td>\n",
              "      <td>66.912010</td>\n",
              "      <td>0</td>\n",
              "      <td>77.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>0.325704</td>\n",
              "      <td>70.125023</td>\n",
              "      <td>65.910683</td>\n",
              "      <td>0</td>\n",
              "      <td>73.666664</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>0.553644</td>\n",
              "      <td>71.329063</td>\n",
              "      <td>68.893646</td>\n",
              "      <td>0</td>\n",
              "      <td>70.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>0.368042</td>\n",
              "      <td>71.262108</td>\n",
              "      <td>66.487671</td>\n",
              "      <td>0</td>\n",
              "      <td>81.000000</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>0.557024</td>\n",
              "      <td>72.482079</td>\n",
              "      <td>70.086472</td>\n",
              "      <td>0</td>\n",
              "      <td>81.500000</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-86966ea2-81fb-4a22-972c-75d758dfbe29')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-86966ea2-81fb-4a22-972c-75d758dfbe29 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-86966ea2-81fb-4a22-972c-75d758dfbe29');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 230
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "tau_hat_XGTE, std_hat_XGTE = att_aiptw(**data_and_nuisance_estimates_XGTE)\n",
        "print(f\"The estimate using XGBoost is {tau_hat_XGTE} pm {1.96*std_hat_XGTE}\")"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "gPCScnwa4wsj",
        "outputId": "fc50d920-fe61-48cf-9218-774a8b5d250b"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "The estimate using XGBoost is -1.862313596001122 pm 1.825616471795112\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "# The table of results"
      ],
      "metadata": {
        "id": "XDCavsMVGuMd"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Natural Direct Effect"
      ],
      "metadata": {
        "id": "FifwR0gFsQ0j"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "NDE_table = [['Outcome','Type of causal effect','Mediator excluded', 'Model', 'Estimate','p/m', 'Standard Error'], \n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Hours', 'RandomForest',tau_hat_RFSH,1.96*std_hat_RFSH, std_hat_RFSH], \n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Hours', 'Logistic Regression',tau_hat_LRSH,1.96*std_hat_LRSH,std_hat_LRSH],\n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Hours', 'XGBoost',tau_hat_XGSH,1.96*std_hat_XGSH,std_hat_XGSH],\n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Habits', 'RandomForest',tau_hat_RFSB,1.96*std_hat_RFSB,std_hat_RFSB], \n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Habits', 'Logistic Regression',tau_hat_LRSB,1.96*std_hat_LRSB,std_hat_LRSB],\n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Habits', 'XGBoost',tau_hat_XGSB,1.96*std_hat_XGSB,std_hat_XGSB],\n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Hours and Study Habits', 'RandomForest',tau_hat_RF,1.96*std_hat_RF,std_hat_RF], \n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Hours and Study Habits', 'Logistic Regression',tau_hat_LR,1.96*std_hat_LR,std_hat_LR],\n",
        "         ['Fall_grade','Natural Direct Effect', 'Study Hours and Study Habits', 'XGBoost',tau_hat_XGB,1.96*std_hat_XGB,std_hat_XGB]]"
      ],
      "metadata": {
        "id": "l6l7o2unG0t4"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "TE_table = [['Outcome','Type of causal effect', 'Model', 'Estimate','p/m', 'Standard Error'],\n",
        "            ['Fall_grade','Total Effect', 'RandomForest',tau_hat_RFTE,1.96*std_hat_RFTE, std_hat_RFTE], \n",
        "            ['Fall_grade','Total Effect', 'Logistic Regression',tau_hat_LRTE,1.96*std_hat_LRTE, std_hat_LRTE],\n",
        "            ['Fall_grade','Total Effect', 'XGBoost',tau_hat_XGTE,1.96*std_hat_XGTE, std_hat_XGTE]]"
      ],
      "metadata": {
        "id": "h8Q9CqAdMY5k"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "df_NDE = pd.DataFrame(NDE_table)\n",
        "df_NDE.columns = df_NDE.iloc[0]\n",
        "df_NDE = df_NDE[1:]\n",
        "df_NDE"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 567
        },
        "id": "pz02hMA-KYyy",
        "outputId": "27c1f20d-9ff4-4a0f-efcb-1e503f85c441"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "0     Outcome  Type of causal effect             Mediator excluded  \\\n",
              "1  Fall_grade  Natural Direct Effect                   Study Hours   \n",
              "2  Fall_grade  Natural Direct Effect                   Study Hours   \n",
              "3  Fall_grade  Natural Direct Effect                   Study Hours   \n",
              "4  Fall_grade  Natural Direct Effect                  Study Habits   \n",
              "5  Fall_grade  Natural Direct Effect                  Study Habits   \n",
              "6  Fall_grade  Natural Direct Effect                  Study Habits   \n",
              "7  Fall_grade  Natural Direct Effect  Study Hours and Study Habits   \n",
              "8  Fall_grade  Natural Direct Effect  Study Hours and Study Habits   \n",
              "9  Fall_grade  Natural Direct Effect  Study Hours and Study Habits   \n",
              "\n",
              "0                Model  Estimate       p/m Standard Error  \n",
              "1         RandomForest -1.837253  1.609899       0.821377  \n",
              "2  Logistic Regression -1.698285  1.598712       0.815669  \n",
              "3              XGBoost -2.571081  2.448955       1.249467  \n",
              "4         RandomForest -2.114952  1.631117       0.832203  \n",
              "5  Logistic Regression -2.057961  1.631844       0.832574  \n",
              "6              XGBoost -2.811477  2.388753       1.218751  \n",
              "7         RandomForest -1.822925  1.602896       0.817804  \n",
              "8  Logistic Regression -1.754583  1.611691       0.822291  \n",
              "9              XGBoost -2.373297   2.57755       1.315077  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-48697504-b685-4507-b7c4-521ead17a286\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>Outcome</th>\n",
              "      <th>Type of causal effect</th>\n",
              "      <th>Mediator excluded</th>\n",
              "      <th>Model</th>\n",
              "      <th>Estimate</th>\n",
              "      <th>p/m</th>\n",
              "      <th>Standard Error</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Hours</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>-1.837253</td>\n",
              "      <td>1.609899</td>\n",
              "      <td>0.821377</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Hours</td>\n",
              "      <td>Logistic Regression</td>\n",
              "      <td>-1.698285</td>\n",
              "      <td>1.598712</td>\n",
              "      <td>0.815669</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Hours</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>-2.571081</td>\n",
              "      <td>2.448955</td>\n",
              "      <td>1.249467</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Habits</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>-2.114952</td>\n",
              "      <td>1.631117</td>\n",
              "      <td>0.832203</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Habits</td>\n",
              "      <td>Logistic Regression</td>\n",
              "      <td>-2.057961</td>\n",
              "      <td>1.631844</td>\n",
              "      <td>0.832574</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Habits</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>-2.811477</td>\n",
              "      <td>2.388753</td>\n",
              "      <td>1.218751</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Hours and Study Habits</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>-1.822925</td>\n",
              "      <td>1.602896</td>\n",
              "      <td>0.817804</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Hours and Study Habits</td>\n",
              "      <td>Logistic Regression</td>\n",
              "      <td>-1.754583</td>\n",
              "      <td>1.611691</td>\n",
              "      <td>0.822291</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>9</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Direct Effect</td>\n",
              "      <td>Study Hours and Study Habits</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>-2.373297</td>\n",
              "      <td>2.57755</td>\n",
              "      <td>1.315077</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-48697504-b685-4507-b7c4-521ead17a286')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-48697504-b685-4507-b7c4-521ead17a286 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-48697504-b685-4507-b7c4-521ead17a286');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 234
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "df_TE = pd.DataFrame(TE_table)\n",
        "df_TE.columns = df_TE.iloc[0]\n",
        "df_TE = df_TE[1:]\n",
        "df_TE"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 187
        },
        "id": "HaA34SDbNFO3",
        "outputId": "239c9ab6-188b-4bf3-8073-5c1f4e69eefc"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "0     Outcome Type of causal effect                Model  Estimate       p/m  \\\n",
              "1  Fall_grade          Total Effect         RandomForest -2.201365  1.669351   \n",
              "2  Fall_grade          Total Effect  Logistic Regression -2.209192  1.635284   \n",
              "3  Fall_grade          Total Effect              XGBoost -1.862314  1.825616   \n",
              "\n",
              "0 Standard Error  \n",
              "1        0.85171  \n",
              "2       0.834328  \n",
              "3       0.931437  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-c683a479-783a-4578-a02b-86a3e2568526\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>Outcome</th>\n",
              "      <th>Type of causal effect</th>\n",
              "      <th>Model</th>\n",
              "      <th>Estimate</th>\n",
              "      <th>p/m</th>\n",
              "      <th>Standard Error</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Total Effect</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>-2.201365</td>\n",
              "      <td>1.669351</td>\n",
              "      <td>0.85171</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Total Effect</td>\n",
              "      <td>Logistic Regression</td>\n",
              "      <td>-2.209192</td>\n",
              "      <td>1.635284</td>\n",
              "      <td>0.834328</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Total Effect</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>-1.862314</td>\n",
              "      <td>1.825616</td>\n",
              "      <td>0.931437</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c683a479-783a-4578-a02b-86a3e2568526')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-c683a479-783a-4578-a02b-86a3e2568526 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-c683a479-783a-4578-a02b-86a3e2568526');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 235
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Table of Natural Indirect Effect"
      ],
      "metadata": {
        "id": "UfOktM7Dp_gV"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "NIE_table = [['Outcome','Type of causal effect','Through which Mediator', 'Model', 'Estimate'], \n",
        "         ['Fall_grade','Natural Indirect Direct Effect', 'Study Hours', 'RandomForest',tau_hat_RFTE - tau_hat_RFSH], \n",
        "         ['Fall_grade','Natural Indirect Direct Effect', 'Study Hours', 'Logistic Regression',tau_hat_LRTE - tau_hat_LRSH],\n",
        "         ['Fall_grade','Natural Indirect Direct Effect', 'Study Hours', 'XGBoost',tau_hat_XGTE - tau_hat_XGSH],\n",
        "         ['Fall_grade','Natural Indirect Direct Effect', 'Study Habits', 'RandomForest',tau_hat_RFTE - tau_hat_RFSB], \n",
        "         ['Fall_grade','Natural Indirect Direct Effect', 'Study Habits', 'Logistic Regression',tau_hat_LRTE - tau_hat_LRSB],\n",
        "         ['Fall_grade','Natural Indirect Direct Effect', 'Study Habits', 'XGBoost',tau_hat_XGTE - tau_hat_XGSB]]"
      ],
      "metadata": {
        "id": "-rc9niODqHkM"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "df_NIE = pd.DataFrame(NIE_table)\n",
        "df_NIE.columns = df_NIE.iloc[0]\n",
        "df_NIE = df_NIE[1:]\n",
        "df_NIE"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 282
        },
        "id": "mYAqYQOFrLwU",
        "outputId": "85e4ce2a-f357-4be8-8f71-f01e3f0981a1"
      },
      "execution_count": null,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "0     Outcome           Type of causal effect Through which Mediator  \\\n",
              "1  Fall_grade  Natural Indirect Direct Effect            Study Hours   \n",
              "2  Fall_grade  Natural Indirect Direct Effect            Study Hours   \n",
              "3  Fall_grade  Natural Indirect Direct Effect            Study Hours   \n",
              "4  Fall_grade  Natural Indirect Direct Effect           Study Habits   \n",
              "5  Fall_grade  Natural Indirect Direct Effect           Study Habits   \n",
              "6  Fall_grade  Natural Indirect Direct Effect           Study Habits   \n",
              "\n",
              "0                Model  Estimate  \n",
              "1         RandomForest -0.364112  \n",
              "2  Logistic Regression -0.510907  \n",
              "3              XGBoost  0.708768  \n",
              "4         RandomForest -0.086413  \n",
              "5  Logistic Regression -0.151231  \n",
              "6              XGBoost  0.949163  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-636e984b-e8e8-49cf-8cac-3e21af872587\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>Outcome</th>\n",
              "      <th>Type of causal effect</th>\n",
              "      <th>Through which Mediator</th>\n",
              "      <th>Model</th>\n",
              "      <th>Estimate</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Indirect Direct Effect</td>\n",
              "      <td>Study Hours</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>-0.364112</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Indirect Direct Effect</td>\n",
              "      <td>Study Hours</td>\n",
              "      <td>Logistic Regression</td>\n",
              "      <td>-0.510907</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Indirect Direct Effect</td>\n",
              "      <td>Study Hours</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>0.708768</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Indirect Direct Effect</td>\n",
              "      <td>Study Habits</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>-0.086413</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Indirect Direct Effect</td>\n",
              "      <td>Study Habits</td>\n",
              "      <td>Logistic Regression</td>\n",
              "      <td>-0.151231</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>Natural Indirect Direct Effect</td>\n",
              "      <td>Study Habits</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>0.949163</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-636e984b-e8e8-49cf-8cac-3e21af872587')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-636e984b-e8e8-49cf-8cac-3e21af872587 button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-636e984b-e8e8-49cf-8cac-3e21af872587');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 237
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Table of Sanity checks results "
      ],
      "metadata": {
        "id": "mswUpixaQNVa"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "San_table = [['Outcome','Mediators','Model','Q model MSE','Q model baseline','g model CE','g model baseline'],\n",
        "             ['Fall_grade', 'none', 'RandomForest', test_mse_RF0, baseline_mse_0, test_ce_RF0, baseline_ce_0],\n",
        "             ['Fall_grade', 'none', 'LogisticRegression', test_mse_LR0, baseline_mse_0, test_ce_LR0, baseline_ce_0],\n",
        "             ['Fall_grade', 'none', 'XGBoost', test_mse_XGB0, baseline_mse_0, test_ce_XGB0, baseline_ce_0],\n",
        "             ['Fall_grade', 'both', 'RandomForest', test_mse_RF1, baseline_mse_1, test_ce_RF1, baseline_ce_1],\n",
        "             ['Fall_grade', 'both', 'LogisticRegression', test_mse_LR1, baseline_mse_1, test_ce_LR1, baseline_ce_1],\n",
        "             ['Fall_grade', 'both', 'XGboost', test_mse_XGB1, baseline_mse_1, test_ce_XGB1, baseline_ce_1],\n",
        "             ['Fall_grade', 'StudyHours', 'RandomForest', test_mse_RF2, baseline_mse_2, test_ce_RF2, baseline_ce_2],\n",
        "             ['Fall_grade', 'StudyHours', 'LogisticRegression', test_mse_LR2, baseline_mse_2, test_ce_LR2, baseline_ce_2],\n",
        "             ['Fall_grade', 'StudyHours', 'XGBoost', test_mse_XGB2, baseline_mse_2, test_ce_XGB2, baseline_ce_2],\n",
        "             ['Fall_grade', 'StudyHabits', 'RandomForest', test_mse_RF3, baseline_mse_3, test_ce_RF3, baseline_ce_3],\n",
        "             ['Fall_grade', 'StudyHabits', 'LogisticRegression', test_mse_LR3, baseline_mse_3, test_ce_LR3, baseline_ce_3],\n",
        "             ['Fall_grade', 'StudyHabits', 'XGBoost', test_mse_XGB3, baseline_mse_3, test_ce_XGB3, baseline_ce_3],\n",
        "             \n",
        "             ]"
      ],
      "metadata": {
        "id": "qs7MclLts7mV"
      },
      "execution_count": 55,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "df_san = pd.DataFrame(San_table)\n",
        "df_san.columns = df_san.iloc[0]\n",
        "df_san = df_san[1:]\n",
        "df_san"
      ],
      "metadata": {
        "id": "XbtJoPgSQRu8",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 426
        },
        "outputId": "5920431b-6940-47d9-9faa-7d394c1f5e44"
      },
      "execution_count": 56,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "0      Outcome    Mediators               Model Q model MSE Q model baseline  \\\n",
              "1   Fall_grade         none        RandomForest  152.611823       151.601951   \n",
              "2   Fall_grade         none  LogisticRegression   149.51816       151.601951   \n",
              "3   Fall_grade         none             XGBoost  157.875933       151.601951   \n",
              "4   Fall_grade         both        RandomForest  169.400559       182.096039   \n",
              "5   Fall_grade         both  LogisticRegression  168.510748       182.096039   \n",
              "6   Fall_grade         both             XGboost  181.723137       182.096039   \n",
              "7   Fall_grade   StudyHours        RandomForest  121.740535       130.438943   \n",
              "8   Fall_grade   StudyHours  LogisticRegression  121.582864       130.438943   \n",
              "9   Fall_grade   StudyHours             XGBoost  127.014899       130.438943   \n",
              "10  Fall_grade  StudyHabits        RandomForest  146.637146        149.82793   \n",
              "11  Fall_grade  StudyHabits  LogisticRegression  160.548133        149.82793   \n",
              "12  Fall_grade  StudyHabits             XGBoost  155.398148        149.82793   \n",
              "\n",
              "0  g model CE g model baseline  \n",
              "1    0.696954         0.692866  \n",
              "2    0.690182         0.692866  \n",
              "3    0.714846         0.692866  \n",
              "4    0.682537         0.693418  \n",
              "5    0.677284         0.693418  \n",
              "6    0.711953         0.693418  \n",
              "7    0.688138         0.693117  \n",
              "8    0.690446         0.693117  \n",
              "9    0.707408         0.693117  \n",
              "10   0.692113         0.692866  \n",
              "11   0.693429         0.692866  \n",
              "12   0.708847         0.692866  "
            ],
            "text/html": [
              "\n",
              "  <div id=\"df-af612394-388a-4a83-a0b7-3280c6c16e5c\">\n",
              "    <div class=\"colab-df-container\">\n",
              "      <div>\n",
              "<style scoped>\n",
              "    .dataframe tbody tr th:only-of-type {\n",
              "        vertical-align: middle;\n",
              "    }\n",
              "\n",
              "    .dataframe tbody tr th {\n",
              "        vertical-align: top;\n",
              "    }\n",
              "\n",
              "    .dataframe thead th {\n",
              "        text-align: right;\n",
              "    }\n",
              "</style>\n",
              "<table border=\"1\" class=\"dataframe\">\n",
              "  <thead>\n",
              "    <tr style=\"text-align: right;\">\n",
              "      <th></th>\n",
              "      <th>Outcome</th>\n",
              "      <th>Mediators</th>\n",
              "      <th>Model</th>\n",
              "      <th>Q model MSE</th>\n",
              "      <th>Q model baseline</th>\n",
              "      <th>g model CE</th>\n",
              "      <th>g model baseline</th>\n",
              "    </tr>\n",
              "  </thead>\n",
              "  <tbody>\n",
              "    <tr>\n",
              "      <th>1</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>none</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>152.611823</td>\n",
              "      <td>151.601951</td>\n",
              "      <td>0.696954</td>\n",
              "      <td>0.692866</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>2</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>none</td>\n",
              "      <td>LogisticRegression</td>\n",
              "      <td>149.51816</td>\n",
              "      <td>151.601951</td>\n",
              "      <td>0.690182</td>\n",
              "      <td>0.692866</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>3</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>none</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>157.875933</td>\n",
              "      <td>151.601951</td>\n",
              "      <td>0.714846</td>\n",
              "      <td>0.692866</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>4</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>both</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>169.400559</td>\n",
              "      <td>182.096039</td>\n",
              "      <td>0.682537</td>\n",
              "      <td>0.693418</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>5</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>both</td>\n",
              "      <td>LogisticRegression</td>\n",
              "      <td>168.510748</td>\n",
              "      <td>182.096039</td>\n",
              "      <td>0.677284</td>\n",
              "      <td>0.693418</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>6</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>both</td>\n",
              "      <td>XGboost</td>\n",
              "      <td>181.723137</td>\n",
              "      <td>182.096039</td>\n",
              "      <td>0.711953</td>\n",
              "      <td>0.693418</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>7</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>StudyHours</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>121.740535</td>\n",
              "      <td>130.438943</td>\n",
              "      <td>0.688138</td>\n",
              "      <td>0.693117</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>8</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>StudyHours</td>\n",
              "      <td>LogisticRegression</td>\n",
              "      <td>121.582864</td>\n",
              "      <td>130.438943</td>\n",
              "      <td>0.690446</td>\n",
              "      <td>0.693117</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>9</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>StudyHours</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>127.014899</td>\n",
              "      <td>130.438943</td>\n",
              "      <td>0.707408</td>\n",
              "      <td>0.693117</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>10</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>StudyHabits</td>\n",
              "      <td>RandomForest</td>\n",
              "      <td>146.637146</td>\n",
              "      <td>149.82793</td>\n",
              "      <td>0.692113</td>\n",
              "      <td>0.692866</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>11</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>StudyHabits</td>\n",
              "      <td>LogisticRegression</td>\n",
              "      <td>160.548133</td>\n",
              "      <td>149.82793</td>\n",
              "      <td>0.693429</td>\n",
              "      <td>0.692866</td>\n",
              "    </tr>\n",
              "    <tr>\n",
              "      <th>12</th>\n",
              "      <td>Fall_grade</td>\n",
              "      <td>StudyHabits</td>\n",
              "      <td>XGBoost</td>\n",
              "      <td>155.398148</td>\n",
              "      <td>149.82793</td>\n",
              "      <td>0.708847</td>\n",
              "      <td>0.692866</td>\n",
              "    </tr>\n",
              "  </tbody>\n",
              "</table>\n",
              "</div>\n",
              "      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-af612394-388a-4a83-a0b7-3280c6c16e5c')\"\n",
              "              title=\"Convert this dataframe to an interactive table.\"\n",
              "              style=\"display:none;\">\n",
              "        \n",
              "  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n",
              "       width=\"24px\">\n",
              "    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n",
              "    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n",
              "  </svg>\n",
              "      </button>\n",
              "      \n",
              "  <style>\n",
              "    .colab-df-container {\n",
              "      display:flex;\n",
              "      flex-wrap:wrap;\n",
              "      gap: 12px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert {\n",
              "      background-color: #E8F0FE;\n",
              "      border: none;\n",
              "      border-radius: 50%;\n",
              "      cursor: pointer;\n",
              "      display: none;\n",
              "      fill: #1967D2;\n",
              "      height: 32px;\n",
              "      padding: 0 0 0 0;\n",
              "      width: 32px;\n",
              "    }\n",
              "\n",
              "    .colab-df-convert:hover {\n",
              "      background-color: #E2EBFA;\n",
              "      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n",
              "      fill: #174EA6;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert {\n",
              "      background-color: #3B4455;\n",
              "      fill: #D2E3FC;\n",
              "    }\n",
              "\n",
              "    [theme=dark] .colab-df-convert:hover {\n",
              "      background-color: #434B5C;\n",
              "      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n",
              "      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n",
              "      fill: #FFFFFF;\n",
              "    }\n",
              "  </style>\n",
              "\n",
              "      <script>\n",
              "        const buttonEl =\n",
              "          document.querySelector('#df-af612394-388a-4a83-a0b7-3280c6c16e5c button.colab-df-convert');\n",
              "        buttonEl.style.display =\n",
              "          google.colab.kernel.accessAllowed ? 'block' : 'none';\n",
              "\n",
              "        async function convertToInteractive(key) {\n",
              "          const element = document.querySelector('#df-af612394-388a-4a83-a0b7-3280c6c16e5c');\n",
              "          const dataTable =\n",
              "            await google.colab.kernel.invokeFunction('convertToInteractive',\n",
              "                                                     [key], {});\n",
              "          if (!dataTable) return;\n",
              "\n",
              "          const docLinkHtml = 'Like what you see? Visit the ' +\n",
              "            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n",
              "            + ' to learn more about interactive tables.';\n",
              "          element.innerHTML = '';\n",
              "          dataTable['output_type'] = 'display_data';\n",
              "          await google.colab.output.renderOutput(dataTable, element);\n",
              "          const docLink = document.createElement('div');\n",
              "          docLink.innerHTML = docLinkHtml;\n",
              "          element.appendChild(docLink);\n",
              "        }\n",
              "      </script>\n",
              "    </div>\n",
              "  </div>\n",
              "  "
            ]
          },
          "metadata": {},
          "execution_count": 56
        }
      ]
    }
  ],
  "metadata": {
    "colab": {
      "provenance": [],
      "toc_visible": true,
      "collapsed_sections": [
        "ALvKeOdnG2Cb"
      ]
    },
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    },
    "language_info": {
      "name": "python"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}
